!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("deviation",[],t):"object"==typeof exports?exports.deviation=t():e.deviation=t()}(global,(function(){return(()=>{var e={5610:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.execute=void 0;const r=n(2051),o=n(4098),l=n(4619),s=n(1609),i=n(6962),u=n(5469),a=n(1176),c=n(2543);t.execute=function(e,t){c.SetColorNone();const n=r.NewPlFile("browser",e),f=new o.default(n),p=new l.PlAstParser(f),T=p.parseAll();if(null==T)return{code:1,ok:!1,trace:[],problems:p.getProblems().map((e=>u.LogProblemShort(e)))};const h=s.EmitProgram(T),y=new a.PlStackMachine(Object.assign(Object.assign({},i.Inout()),t),n,[]);y.addProgram(h);const d=y.runProgram();if(null==d){const e=y.getTrace(),t=y.getProblems();return{code:1,ok:!1,trace:u.LogTrace(e).split("\n"),problems:t.map((e=>u.LogProblemShort(e)))}}y.inout.flush();let P=0;return"number"==typeof d.value&&(P=d.value),{code:P,ok:!0,trace:[],problems:[]}}},5818:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsVariableRest=t.IsVariableHead=t.Errors=t.Execute=t.Highlight=void 0;const r=n(2051),o=n(4098),l=n(4619),s=n(50),i=n(1609),u=n(1176),a=n(6962),c=n(5469),f=n(5061),p=n(181);t.Highlight=function(e){const t=r.NewPlFile("highlighter",e),n=new o.default(t),i=new l.PlAstParser(n),u=i.parseAll();return 0!=i.getProblems().length?null:s.ASTProgramToColorRegions(u)},t.Execute=function(e,t){const n=r.NewPlFile("execute",e),s=new o.default(n),f=new l.PlAstParser(s),p=f.parseAll();if(null==p){const e=f.getProblems(),n=[];for(const t of e)n.push(c.LogProblemShort(t));return t.print(n.join("\n")),t.flush(),1}const T=i.EmitProgram(p,!0),h=new u.PlStackMachine(Object.assign(Object.assign(Object.assign({},a.Inout()),t),{print:e=>{t.print(e),t.flush()}}),n,[]);h.addProgram(T);const y=h.runProgram();if(null==y){const e=h.getProblems(),n=[];for(const t of e)n.push(c.LogProblemShort(t));return t.print(n.join("\n")),t.flush(),1}return t.flush(),"number"==typeof y.value?y.value:0},t.Errors=function(e){return p.TryRunParser(r.NewPlFile("errors",e))},t.IsVariableHead=function(e){return f.isvariablefirst(e)},t.IsVariableRest=function(e){return f.isvariablerest(e)}},1036:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{u(r.next(e))}catch(e){l(e)}}function i(e){try{u(r.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Useful=t.Execute=t.Inject=t.ExecuteBrowserTags=void 0;const o=n(181),l=n(2051),s=n(1176),i=n(6962),u=n(5610),a=n(5818);t.ExecuteBrowserTags=function(){var e;e=()=>r(this,void 0,void 0,(function*(){const e=yield function(){return r(this,void 0,void 0,(function*(){const e=Array.from(document.querySelectorAll('script[type="application/devia"]')),t=[];let n=0;for(const r of e){n++;const e=r.getAttribute("src");if(null!=e)try{const n=window.location.pathname.split("/");n.pop();const r=yield fetch(`${window.location.origin+n.join("/")}/${e}`);if(!r.ok)throw null;const o=yield r.text();t.push(l.NewPlFile(e,o)),console.debug(`loaded external script '${e}'`)}catch(t){return alert(`there is no file called ${e}\nhalting devia interpreter...`),[]}else t.push(l.NewPlFile(`browser${n}`,r.innerText))}return t}))}(),t=new s.PlStackMachine(Object.assign(Object.assign({},i.Inout()),{print:e=>{i.Inout().print(e),i.Inout().flush()}}),l.NewPlFile("browser.de",""),[]);for(const n of e){const e=o.RunFile(t,n);if(console.debug(`[${n.filename}] sync return code: ${e}`),0!==e)break}})),"loading"!=document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",(function(){"loading"!=document.readyState&&e()}))},t.Inject=function e(t=null){if(null==t)return e(a);let n=window;n.data=Object.assign(Object.assign({},n.data),{exports:Object.assign(Object.assign({},(n.data||{}).exports),t)})},t.Execute=u.execute,t.Useful=a},4098:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3550),o=n(7991),l=n(5061),s=n(1717);t.default=class{constructor(e){this.filename=e.filename,this.content=e.content,this.contentSize=this.content.length,this.charPointer=0,this.currentRow=0,this.currentCol=0,this.problems=[],this.buffer=[]}currentChar(){return this.content[this.charPointer]}nextChar(){return this.content[this.charPointer+1]}currentFileInfo(e){return o.NewFileInfo(this.currentRow,this.currentCol,e,this.filename)}eofFileInfo(){return o.NewFileInfo(this.currentRow,this.currentCol+1,1,this.filename)}errFileInfo(){return o.NewFileInfo(this.currentRow,this.currentCol+1,1,this.filename)}advancePointer(){return++this.currentCol,++this.charPointer,this.currentChar()}advanceRow(){++this.currentRow,this.currentCol=0}isEOF(){return this.charPointer>=this.contentSize}isNextEOF(){return this.charPointer+1>=this.contentSize}testNextChars(e,t){const n=e.length;let o;for(o=0;o<n;++o){if(this.isEOF()||this.currentChar()!==e[o])return this.currentCol-=o,this.charPointer-=o,null;this.advancePointer()}return r.NewPlToken(t,e,this.currentFileInfo(o))}testNextKeyword(e,t){const n=e.length;let o;for(o=0;o<n;++o){if(this.isEOF()||this.currentChar()!==e[o])return this.currentCol-=o,this.charPointer-=o,null;this.advancePointer()}return!this.isEOF()&&l.isvariablerest(this.currentChar())?(this.currentCol-=o,this.charPointer-=o,null):r.NewPlToken(t,e,this.currentFileInfo(o))}newErrorToken(e,t,...n){return this.problems.push(s.NewPlProblem(e,t,...n)),r.NewPlToken(r.PlTokenType.ERR,"",t)}addBuffer(e){this.buffer.push(e)}popBuffer(){return this.buffer.shift()}haveBuffered(){return this.buffer.length>0}nextToken(e=!0){if(e&&this.haveBuffered())return this.popBuffer();if(this.isEOF())return r.NewPlToken(r.PlTokenType.EOF,"eof",this.eofFileInfo());for(;l.isblank(this.currentChar());)this.advancePointer();if(this.isEOF())return r.NewPlToken(r.PlTokenType.EOF,"eof",this.eofFileInfo());for(;!this.isEOF()&&"#"===this.currentChar();)do{this.advancePointer()}while(!this.isEOF()&&"\n"!==this.currentChar());if(this.isEOF())return r.NewPlToken(r.PlTokenType.EOF,"eof",this.eofFileInfo());let t=this.currentChar();if(l.isnum(t)){let e="";const n=this.currentCol;do{e+=t,this.advancePointer(),t=this.currentChar()}while(l.isnum(t)&&!this.isEOF());if(!this.isEOF()&&!this.isNextEOF()&&"."===t&&l.isnum(this.nextChar()))do{e+=t,this.advancePointer(),t=this.currentChar()}while(l.isnum(t)&&!this.isEOF());if(!this.isEOF()&&!this.isNextEOF()&&("e"==t||"E"==t)&&(l.isnum(this.nextChar())||"-"==this.nextChar())){"-"==this.nextChar()&&(e+=t,this.advancePointer(),t=this.currentChar());do{e+=t,this.advancePointer(),t=this.currentChar()}while(l.isnum(t)&&!this.isEOF())}return r.NewPlToken(r.PlTokenType.NUMBER,e,this.currentFileInfo(this.currentCol-n))}const n={".":r.PlTokenType.DOT,"{":r.PlTokenType.LBRACE,"}":r.PlTokenType.RBRACE,"(":r.PlTokenType.LPAREN,")":r.PlTokenType.RPAREN,",":r.PlTokenType.COMMA,":":r.PlTokenType.COLON,";":r.PlTokenType.SEMICOLON,"[":r.PlTokenType.LBRACK,"]":r.PlTokenType.RBRACK};if(n.hasOwnProperty(t))return this.advancePointer(),r.NewPlToken(n[t],t,this.currentFileInfo(1));switch(t){case"+":return this.testNextChars("++",r.PlTokenType.INC)||(this.advancePointer(),r.NewPlToken(r.PlTokenType.ADD,t,this.currentFileInfo(1)));case"-":return this.testNextChars("--",r.PlTokenType.DEC)||(this.advancePointer(),r.NewPlToken(r.PlTokenType.SUB,t,this.currentFileInfo(1)));case"*":return this.advancePointer(),r.NewPlToken(r.PlTokenType.MUL,t,this.currentFileInfo(1));case"/":return this.testNextChars("/=",r.PlTokenType.NEQ)||(this.advancePointer(),r.NewPlToken(r.PlTokenType.DIV,t,this.currentFileInfo(1)));case"=":return this.testNextChars("==",r.PlTokenType.EQ)||(this.advancePointer(),r.NewPlToken(r.PlTokenType.ASGN,t,this.currentFileInfo(1)));case">":return this.testNextChars(">=",r.PlTokenType.GTE)||(this.advancePointer(),r.NewPlToken(r.PlTokenType.GT,t,this.currentFileInfo(1)));case"<":return this.testNextChars("<=",r.PlTokenType.LTE)||(this.advancePointer(),r.NewPlToken(r.PlTokenType.LT,t,this.currentFileInfo(1)));case"f":for(const e of[["func",r.PlTokenType.FUNC],["for",r.PlTokenType.FOR],["false",r.PlTokenType.BOOLEAN]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"i":for(const e of[["impl",r.PlTokenType.IMPL],["import",r.PlTokenType.IMPORT],["if",r.PlTokenType.IF]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"a":for(const e of[["as",r.PlTokenType.AS],["and",r.PlTokenType.AND]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"t":for(const e of[["true",r.PlTokenType.BOOLEAN],["type",r.PlTokenType.TYPE]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"e":for(const e of[["export",r.PlTokenType.EXPORT],["elif",r.PlTokenType.ELIF],["else",r.PlTokenType.ELSE],["each",r.PlTokenType.EACH]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"r":for(const e of[["return",r.PlTokenType.RETURN]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"b":for(const e of[["break",r.PlTokenType.BREAK]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"c":for(const e of[["continue",r.PlTokenType.CONTINUE],["case",r.PlTokenType.CASE]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"l":for(const e of[["loop",r.PlTokenType.LOOP]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"w":for(const e of[["while",r.PlTokenType.WHILE]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"m":for(const e of[["match",r.PlTokenType.MATCH]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"d":for(const e of[["default",r.PlTokenType.DEFAULT]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"o":for(const e of[["or",r.PlTokenType.OR],["of",r.PlTokenType.OF]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"n":for(const e of[["not",r.PlTokenType.NOT],["null",r.PlTokenType.NULL]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"s":for(const e of[["select",r.PlTokenType.SELECT]]){const[t,n]=e,r=this.testNextKeyword(t,n);if(r)return r}break;case"\n":{this.advancePointer();const e=r.NewPlToken(r.PlTokenType.LF,"\n",this.currentFileInfo(1));return this.advanceRow(),e}}if('"'===t){let e="";if(null!=this.testNextChars('"""',r.PlTokenType.STR)){const n=this.currentRow,l=this.currentCol;for(;;){if(this.isEOF())return this.newErrorToken("CE0008",o.NewFileInfo(n,l,3,this.filename));if(t=this.currentChar(),e+=t,null!=this.testNextChars('"""',r.PlTokenType.STR))break;"\n"==t?(this.advanceRow(),++this.charPointer):this.advancePointer()}let s;return s=this.currentRow!=n?this.currentFileInfo(3):this.currentFileInfo(this.currentCol-l),r.NewPlToken(r.PlTokenType.STR,e.substring(0,e.length-1),s)}this.advancePointer();let n=this.currentCol;const l=this.buffer.length,s=this.currentFileInfo(1);for(;;){if(this.isEOF())return this.newErrorToken("LE0002",s);if(t=this.currentChar(),"\n"==t)return this.newErrorToken("LE0002",s);if("\\"!==t){if(e+=t,'"'==t){this.advancePointer();break}this.advancePointer()}else{switch(this.advancePointer(),t=this.currentChar(),t){case"n":e+="\n";break;case"t":e+="\t";break;case"r":e+="\r";break;case"f":e+="\f";break;case'"':e+='"';break;case"\\":e+="\\";break;case"(":{this.addBuffer(r.NewPlToken(r.PlTokenType.STR,e.substring(0,e.length),this.currentFileInfo(this.currentCol-n+1))),e="",this.advancePointer(),this.addBuffer(r.NewPlToken(r.PlTokenType.ADD,"+",this.currentFileInfo(2))),this.addBuffer(r.NewPlToken(r.PlTokenType.VARIABLE,"Str",o.NewEmptyFileInfo(""))),this.addBuffer(r.NewPlToken(r.PlTokenType.LPAREN,"(",o.NewEmptyFileInfo("")));const t=this.currentFileInfo(2);let l=0;for(;;){const e=this.buffer.length,n=this.nextToken(!1);if(n.type==r.PlTokenType.ERR)return n;if(n.type===r.PlTokenType.EOF||n.type==r.PlTokenType.LF)return this.newErrorToken("LE0004",t);if(this.buffer.length-e>1)this.buffer.splice(e,0,n);else if(this.addBuffer(n),n.type==r.PlTokenType.LPAREN)l++;else if(n.type===r.PlTokenType.RPAREN){if(0==l)break;l--}}this.addBuffer(r.NewPlToken(r.PlTokenType.ADD,"+",this.currentFileInfo(1))),n=this.currentCol+1;continue}default:return this.newErrorToken("LE0003",o.NewFileInfo(this.currentRow,this.currentCol+1,2,this.filename),t)}this.advancePointer()}}const i=this.buffer.length-l>0;return this.addBuffer(r.NewPlToken(r.PlTokenType.STR,e.substring(0,e.length-1),this.currentFileInfo(this.currentCol-n+1))),i?(this.addBuffer(r.NewPlToken(r.PlTokenType.RPAREN,")",this.currentFileInfo(1))),r.NewPlToken(r.PlTokenType.LPAREN,"(",s)):this.buffer.pop()}if(l.isvariablefirst(t)){let e="";const n=this.currentCol;do{e+=t,this.advancePointer(),t=this.currentChar()}while(!this.isEOF()&&l.isvariablerest(t));return r.NewPlToken(r.PlTokenType.VARIABLE,e,this.currentFileInfo(this.currentCol-n))}return this.newErrorToken("LE0001",this.errFileInfo(),t)}parseAll(){let e=[];for(;;){const t=this.nextToken();if(e.push(t),t.type===r.PlTokenType.EOF||t.type===r.PlTokenType.ERR)break}return e}getProblems(){return this.problems}}},7991:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFileInfo=t.NewEmptyFileInfo=void 0,t.NewEmptyFileInfo=function(e){return{row:0,col:0,length:0,filename:e}},t.NewFileInfo=function(e,t,n,r){return{row:e,col:t,length:n,filename:r}}},3550:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlTokenToString=t.NewFakePlToken=t.NewPlToken=t.PlTokenToPlVariable=t.TOKEN_VAR_BLACKLIST=t.TOKEN_OPERATORS=t.NAME_BLACKLIST=t.PlTokenType=void 0;const r=n(7991),o=n(1624);var l;function s(e,t,n){return{type:e,content:t,info:n}}!function(e){e[e.FUNC=0]="FUNC",e[e.IMPL=1]="IMPL",e[e.IMPORT=2]="IMPORT",e[e.AS=3]="AS",e[e.SELECT=4]="SELECT",e[e.EXPORT=5]="EXPORT",e[e.RETURN=6]="RETURN",e[e.BREAK=7]="BREAK",e[e.CONTINUE=8]="CONTINUE",e[e.IF=9]="IF",e[e.ELIF=10]="ELIF",e[e.ELSE=11]="ELSE",e[e.EACH=12]="EACH",e[e.OF=13]="OF",e[e.LOOP=14]="LOOP",e[e.WHILE=15]="WHILE",e[e.FOR=16]="FOR",e[e.MATCH=17]="MATCH",e[e.CASE=18]="CASE",e[e.DEFAULT=19]="DEFAULT",e[e.AND=20]="AND",e[e.OR=21]="OR",e[e.NOT=22]="NOT",e[e.DOT=23]="DOT",e[e.ADD=24]="ADD",e[e.SUB=25]="SUB",e[e.MUL=26]="MUL",e[e.DIV=27]="DIV",e[e.ASGN=28]="ASGN",e[e.INC=29]="INC",e[e.DEC=30]="DEC",e[e.GT=31]="GT",e[e.LT=32]="LT",e[e.GTE=33]="GTE",e[e.LTE=34]="LTE",e[e.EQ=35]="EQ",e[e.NEQ=36]="NEQ",e[e.LBRACE=37]="LBRACE",e[e.RBRACE=38]="RBRACE",e[e.LPAREN=39]="LPAREN",e[e.RPAREN=40]="RPAREN",e[e.COMMA=41]="COMMA",e[e.COLON=42]="COLON",e[e.SEMICOLON=43]="SEMICOLON",e[e.LBRACK=44]="LBRACK",e[e.RBRACK=45]="RBRACK",e[e.TYPE=46]="TYPE",e[e.NUMBER=47]="NUMBER",e[e.BOOLEAN=48]="BOOLEAN",e[e.VARIABLE=49]="VARIABLE",e[e.NULL=50]="NULL",e[e.STR=51]="STR",e[e.LF=52]="LF",e[e.EOF=53]="EOF",e[e.SPAN=54]="SPAN",e[e.ERR=55]="ERR"}(l=t.PlTokenType||(t.PlTokenType={})),t.NAME_BLACKLIST=[l.LPAREN,l.RPAREN,l.LBRACE,l.RBRACE,l.COMMA,l.COLON,l.SEMICOLON,l.DOT,l.ADD,l.SUB,l.MUL,l.DIV,l.ASGN,l.INC,l.DEC,l.GT,l.LT,l.GTE,l.LTE,l.EQ,l.NEQ,l.LF,l.EOF],t.TOKEN_OPERATORS=[l.ADD,l.SUB,l.MUL,l.DIV,l.GT,l.GTE,l.LT,l.LTE,l.EQ,l.NEQ],t.TOKEN_VAR_BLACKLIST=[l.COLON,l.LBRACE,l.RBRACE,l.LPAREN,l.RPAREN,l.COMMA,l.DOT,l.LF,l.EOF,l.SEMICOLON],t.PlTokenToPlVariable=function(e){return e.type==l.VARIABLE?e:t.TOKEN_VAR_BLACKLIST.includes(e.type)?null:s(l.VARIABLE,e.content,e.info)},t.NewPlToken=s,t.NewFakePlToken=function(e,t){return{type:e,content:t,info:r.NewEmptyFileInfo("")}},t.PlTokenToString=function(e){return`[${e.type}|'${o.escapeString(e.content)}'|${e.info.row}:${e.info.col-e.info.length}-${e.info.col},<${e.info.filename}>]`}},4538:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ASTVariable=t.ASTNull=t.ASTString=t.ASTBoolean=t.ASTNumber=t.ASTClosure=t.ASTDict=t.ASTList=t.ASTType=t.ASTUnary=t.ASTBinary=t.ASTCall=t.ASTDot=t.ASTCreate=t.ASTAssign=t.ASTMatch=t.ASTFor=t.ASTWhile=t.ASTLoop=t.ASTEach=t.ASTIf=t.ASTContinue=t.ASTBreak=t.ASTReturn=t.ASTExport=t.ASTImport=t.ASTImpl=t.ASTFunction=t.ASTBlock=t.ASTExpression=t.ASTStatement=t.ASTNode=t.ASTAttributes=t.CreateSpanToken=t.ASTProgramToString=void 0;const r=n(3550),o=n(7991);function l(e,t,n=null){return null==n&&(n=e.content+t.content),r.NewPlToken(r.PlTokenType.SPAN,n,o.NewFileInfo(e.info.row,t.info.col,t.info.col-e.info.col+e.info.length,e.info.filename))}t.ASTProgramToString=function(e){let t=[];for(const n of e)t.push(JSON.stringify(n));return t.map(((e,t)=>`Line ${t+1}| ${e}`)).join("\n")},t.CreateSpanToken=l,(t.ASTAttributes||(t.ASTAttributes={})).ASTCondition="ASTCondition";class s{constructor(e){this.tokens=e,this.attribute=null}firstToken(){return this.tokens[0]}lastToken(){return this.tokens[this.tokens.length-1]}getSpanToken(){try{const e=this.firstToken(),t=this.lastToken();return t.info.row!=e.info.row?e:l(e,t,this.tokens.map((e=>e.content)).join(""))}catch(e){if(0==this.tokens.length)return r.NewFakePlToken(r.PlTokenType.SPAN,"")}}is(e){return this instanceof e}}t.ASTNode=s;class i extends s{}t.ASTStatement=i;class u extends s{}t.ASTExpression=u,t.ASTBlock=class extends i{constructor(e,t){super(e),this.statements=t}},t.ASTFunction=class extends i{constructor(e,t,n,r,o){super(e),this.name=t,this.args=n,this.guards=r,this.block=o}lastToken(){return this.block.getSpanToken()}},t.ASTImpl=class extends i{constructor(e,t,n,r,o,l){super(e),this.name=t,this.args=n,this.guards=r,this.target=o,this.block=l}lastToken(){return this.block.getSpanToken()}},t.ASTImport=class extends i{constructor(e,t,n,r){super(e),this.path=t,this.alias=n,this.select=r}},t.ASTExport=class extends i{constructor(e,t){super(e),this.content=t}},t.ASTReturn=class extends i{constructor(e,t){super(e),this.content=t}},t.ASTBreak=class extends i{constructor(e){super(e)}},t.ASTContinue=class extends i{constructor(e){super(e)}},t.ASTIf=class extends i{constructor(e,t,n,r){super(e),this.conditions=t,this.blocks=n,this.other=r}lastToken(){return this.other?this.other.getSpanToken():this.blocks[this.blocks.length-1].getSpanToken()}},t.ASTEach=class extends i{constructor(e,t,n,r,o){super(e),this.value=t,this.key=o,this.iterator=n,this.block=r}lastToken(){return this.block.getSpanToken()}},t.ASTLoop=class extends i{constructor(e,t,n){super(e),this.amount=n,this.block=t}lastToken(){return this.block.getSpanToken()}},t.ASTWhile=class extends i{constructor(e,t,n){super(e),this.condition=t,this.block=n}lastToken(){return this.block.getSpanToken()}},t.ASTFor=class extends i{constructor(e,t,n,r,o){super(e),this.start=n,this.condition=r,this.after=o,this.block=t}lastToken(){return this.block.getSpanToken()}},t.ASTMatch=class extends i{constructor(e,t,n,r,o){super(e),this.value=t,this.cases=n,this.blocks=r,this.other=o}};class a extends u{constructor(e,t,n,r){super(e),this.pre=t,this.variable=n,this.value=r}firstToken(){return null==this.pre?this.variable.getSpanToken():this.pre.getSpanToken()}lastToken(){return this.value.getSpanToken()}}t.ASTAssign=a,t.ASTCreate=class extends a{},t.ASTDot=class extends u{constructor(e,t,n){super(e),this.left=t,this.right=n}firstToken(){return this.left.getSpanToken()}lastToken(){return this.right.getSpanToken()}},t.ASTCall=class extends u{constructor(e,t,n){super(e),this.target=t,this.args=n}firstToken(){return this.target.getSpanToken()}lastToken(){return this.target.getSpanToken()}},t.ASTBinary=class extends u{constructor(e,t,n,r){super(e),this.left=t,this.right=n,this.operator=r}firstToken(){return this.left.getSpanToken()}lastToken(){return this.right.getSpanToken()}},t.ASTUnary=class extends u{constructor(e,t,n){super(e),this.operator=t,this.value=n}isPostfix(){return this.operator.type==r.PlTokenType.INC||this.operator.type==r.PlTokenType.DEC}firstToken(){return this.isPostfix()?this.value.getSpanToken():this.operator}lastToken(){return this.isPostfix()?this.operator:this.value.getSpanToken()}},t.ASTType=class extends u{constructor(e,t,n){super(e),this.name=t,this.members=n}firstToken(){return this.name.getSpanToken()}lastToken(){return this.name.getSpanToken()}},t.ASTList=class extends u{constructor(e,t){super(e),this.values=t}},t.ASTDict=class extends u{constructor(e,t,n){super(e),this.keys=t,this.values=n}},t.ASTClosure=class extends u{constructor(e,t,n,r){super(e),this.args=t,this.guards=n,this.block=r}},t.ASTNumber=class extends u{constructor(e,t){super(e),this.value=t}},t.ASTBoolean=class extends u{constructor(e,t){super(e),this.value=t}},t.ASTString=class extends u{constructor(e,t){super(e),this.content=t}},t.ASTNull=class extends u{constructor(e){super(e)}},t.ASTVariable=class extends u{constructor(e,t){super(e),this.content=t}}},50:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ASTProgramHighlight=t.ASTProgramToColorRegions=void 0;const r=n(866),o=n(4538),l=n(2543);function s(e,t){return{info:e,color:t}}function i(e,t,n){return e==n.info.row&&t>=n.info.col-n.info.length&&t<n.info.col}function u(e,t){if(null!=e)if(t(e),e instanceof o.ASTBlock)for(const n of e.statements)u(n,t);else if(e instanceof o.ASTBinary)u(e.left,t),u(e.right,t);else if(e instanceof o.ASTUnary)u(e.value,t);else if(e instanceof o.ASTList)for(const n of e.values)u(n,t);else if(e instanceof o.ASTDict)for(const n of Object.values(e.values))u(n,t);else if(e instanceof o.ASTType){u(e.name,t);for(const n of e.members)u(n,t)}else if(e instanceof o.ASTCall){u(e.target,t);for(const n of e.args)u(n,t)}else if(e instanceof o.ASTDot)u(e.left,t),u(e.right,t);else if(e instanceof o.ASTFunction){u(e.name,t);for(const n of e.args)u(n,t);u(e.block,t)}else if(e instanceof o.ASTImpl){u(e.name,t);for(const n of e.args)u(n,t);u(e.block,t)}else if(e instanceof o.ASTReturn)u(e.content,t);else if(e instanceof o.ASTIf){for(let n=0;n<e.conditions.length;n++)u(e.conditions[n],t),u(e.blocks[n],t);u(e.other,t)}else if(e instanceof o.ASTWhile)u(e.condition,t),u(e.block,t);else if(e instanceof o.ASTFor)u(e.start,t),u(e.condition,t),u(e.after,t),u(e.block,t);else if(e instanceof o.ASTMatch){u(e.value,t);for(let n=0;n<e.cases.length;n++){for(const r of e.cases[n])u(r,t);u(e.blocks[n],t)}e.other&&u(e.other,t)}else if(e instanceof o.ASTClosure){for(const n of e.args)u(n,t);u(e.block,t)}else e instanceof o.ASTEach?(u(e.key,t),u(e.value,t),u(e.iterator,t),u(e.block,t)):e instanceof o.ASTLoop?(u(e.amount,t),u(e.block,t)):(e instanceof o.ASTAssign||e instanceof o.ASTCreate)&&(u(e.pre,t),u(e.variable,t),u(e.value,t))}t.ASTProgramToColorRegions=function(e){const t=[];function n(e){if(e instanceof o.ASTString){const n=e.getSpanToken().info;t.push(s(n,r.HIGHLIGHT.sr))}else if(e instanceof o.ASTImpl){let n=e.tokens[0].info;t.push(s(n,r.HIGHLIGHT.kw)),n=e.tokens[1].info,t.push(s(n,r.HIGHLIGHT.kw))}else if(e instanceof o.ASTIf){for(let n=0;n<e.conditions.length;n++){const o=e.tokens[n].info;t.push(s(o,r.HIGHLIGHT.kw))}if(e.other){const n=e.tokens[e.tokens.length-1].info;t.push(s(n,r.HIGHLIGHT.kw))}}else if(e instanceof o.ASTReturn){if(e.tokens.length>0){const n=e.tokens[0].info;t.push(s(n,r.HIGHLIGHT.kw))}}else if(e instanceof o.ASTBinary){const n=e.operator.info;t.push(s(n,r.HIGHLIGHT.op))}else if(e instanceof o.ASTAssign||e instanceof o.ASTCreate){const n=e.tokens[0].info;t.push(s(n,r.HIGHLIGHT.mt))}else if(e instanceof o.ASTEach)t.push(s(e.tokens[0].info,r.HIGHLIGHT.kw)),t.push(s(e.tokens[1].info,r.HIGHLIGHT.kw));else if(e instanceof o.ASTLoop)t.push(s(e.tokens[0].info,r.HIGHLIGHT.kw));else if(e instanceof o.ASTCall)t.push(s(e.target.lastToken().info,r.HIGHLIGHT.mt));else if(e instanceof o.ASTBreak||e instanceof o.ASTContinue||e instanceof o.ASTBoolean||e instanceof o.ASTNull||e instanceof o.ASTFor||e instanceof o.ASTWhile||e instanceof o.ASTLoop||e instanceof o.ASTFunction||e instanceof o.ASTType||e instanceof o.ASTClosure||e instanceof o.ASTList||e instanceof o.ASTDict)t.push(s(e.tokens[0].info,r.HIGHLIGHT.kw));else if(e instanceof o.ASTNumber)t.push(s(e.getSpanToken().info,r.HIGHLIGHT.nu));else if(e instanceof o.ASTUnary)t.push(s(e.operator.info,r.HIGHLIGHT.op));else if(e instanceof o.ASTMatch)for(const n of e.tokens)t.push(s(n.info,r.HIGHLIGHT.kw))}for(const t of e)u(t,n);return t.filter((e=>e.info.length>0)).sort(((e,t)=>{if(e.info.row>t.info.row)return 1;if(t.info.row>e.info.row)return-1;const n=e.info.col-e.info.length,r=t.info.col-t.info.length;return n>r?1:r>n?-1:0}))},t.ASTProgramHighlight=function(e,t){const n=t.split("\n");let r="",o=0,s=null;for(let t=0;t<n.length;t++){const u=n[t];for(let n=0;n<u.length;n++){const a=e[o],c=e[o-1];null!=a&&i(t,n,a)?(s=a.color,o+=1):null==c||i(t,n,c)||(s=null),r+=null==s?u[n]:l.colors[s](u[n])}r+="\n"}return r}},4619:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlAstParser=t.CREATE_MAGIC=void 0;const r=n(1717),o=n(4538),l=n(3550);class s{}function i(e){e.content.startsWith(t.CREATE_MAGIC)&&(e.content=e.content.slice(1))}t.CREATE_MAGIC="@",t.PlAstParser=class{constructor(e){this.lexer=e,this.cacheToken=[],this.problems=[]}getProblems(){return[...this.problems,...this.lexer.getProblems()]}parseOnce(){try{return this.pStatement()}catch(e){return e instanceof s||this.newProblem(this.getToken(),"DE0001",""+e),null}}parseAll(){let e=[];for(;;){try{if(this.isEOF())break}catch(e){return null}const t=this.parseOnce();if(null==t)return null;e.push(t)}return e}isEOF(){return this.clearLF(),this.peekToken().type==l.PlTokenType.EOF}getToken(){return 0!=this.cacheToken.length?this.cacheToken.pop():this.lexer.nextToken()}nextToken(){const e=this.getToken();if(e.type==l.PlTokenType.ERR)throw new s;return e}peekToken(){const e=this.getToken();if(this.cacheToken.push(e),e.type==l.PlTokenType.ERR)throw new s;return e}pushToken(e){this.cacheToken.push(e)}expectedPeekToken(e,t,n,...r){return null==this.tryPeekToken(e,t,n,...r)?null:this.nextToken()}tryPeekToken(e,t,n,...o){const l=this.peekToken();return l.type!=e?(null==n?this.problems.push(r.NewPlProblem(t,l.info,...o)):this.problems.push(r.NewPlProblemAt(t,n.info,"after",...o)),null):l}tryPeekTokens(e,t,n,...o){const l=this.peekToken();let s=!1;for(const t of e)if(l.type==t){s=!0;break}return s?l:(null==n?this.problems.push(r.NewPlProblem(t,l.info,...o)):this.problems.push(r.NewPlProblemAt(t,n.info,"after",...o)),null)}peekMatch(e){const t=this.peekToken();for(const n of e)if(t.type==n)return!0;return!1}clearLF(){for(;this.peekToken().type==l.PlTokenType.LF;)this.nextToken()}newProblem(e,t,...n){return this.problems.push(r.NewPlProblem(t,e.info,...n)),null}newProblemAt(e,t,n,...o){return this.problems.push(r.NewPlProblemAt(t,e.info,n,...o)),null}pStatement(){const e=this.peekToken();if(null==e)return null;let t;switch(e.type){case l.PlTokenType.LBRACE:t=this.pBlock();break;case l.PlTokenType.FUNC:t=this.pFunction();break;case l.PlTokenType.IMPL:t=this.pImpl();break;case l.PlTokenType.IMPORT:t=this.pImport();break;case l.PlTokenType.EXPORT:t=this.pExport();break;case l.PlTokenType.RETURN:t=this.pReturn();break;case l.PlTokenType.BREAK:t=this.pBreak();break;case l.PlTokenType.CONTINUE:t=this.pContinue();break;case l.PlTokenType.IF:t=this.pIf();break;case l.PlTokenType.EACH:t=this.pEach();break;case l.PlTokenType.LOOP:t=this.pLoop();break;case l.PlTokenType.WHILE:t=this.pWhile();break;case l.PlTokenType.FOR:t=this.pFor();break;case l.PlTokenType.MATCH:t=this.pMatch();break;case l.PlTokenType.TYPE:t=this.pType();break;default:t=this.pExpression()}if(null==t)return null;const n=this.peekToken();if(n.type!=l.PlTokenType.LF){if(n.type==l.PlTokenType.SEMICOLON)this.nextToken();else if(n.type!=l.PlTokenType.EOF)return this.newProblemAt(n,"ET0001","before"),null}else this.nextToken();return t}pBlock(){const e=[this.nextToken()];let t=[];for(;;){this.clearLF();const n=this.peekToken();if(n.type==l.PlTokenType.RBRACE)break;if(n.type==l.PlTokenType.EOF)return this.newProblem(e[0],"CE0001"),null;const r=this.pStatement();if(null==r)return null;t.push(r)}return e.push(this.nextToken()),new o.ASTBlock(e,t)}pFunction(){let e=[this.nextToken()];const t=this.tryPeekToken(l.PlTokenType.VARIABLE,"ET0013",null);if(null==t)return null;const n=this.pVariable();i(n);const r=this.expectedPeekToken(l.PlTokenType.LPAREN,"ET0014",t);if(null==r)return null;const s=this.pParam(r,"ET0016","ET0015");if(null==s)return null;const u=s.tokens[s.tokens.length-1];if(null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0017",u))return null;const a=this.pBlock();return null==a?null:new o.ASTFunction(e,n,s.params,s.guards,a)}pImpl(){const e=[this.nextToken()];let t;const n=this.peekToken();if(n.type==l.PlTokenType.VARIABLE)t=this.pVariable(),i(t);else{if(!l.TOKEN_OPERATORS.includes(n.type)&&n.type!=l.PlTokenType.TYPE)return this.newProblem(n,"ET0027"),null;{this.nextToken();const e=l.PlTokenToPlVariable(n);t=new o.ASTVariable([e],e.content)}}const r=this.expectedPeekToken(l.PlTokenType.LPAREN,"ET0028",t.getSpanToken());if(null==r)return null;const s=this.pParam(r,"ET0016","ET0015");if(null==s)return null;const u=s.tokens[s.tokens.length-1],a=this.expectedPeekToken(l.PlTokenType.FOR,"ET0029",u);if(null==a)return null;if(this.peekToken().type==l.PlTokenType.EOF)return this.newProblemAt(a,"ET0043","after"),null;const c=this.pVariable();if(i(c),null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0030",c.getSpanToken()))return null;const f=this.pBlock();return null==f?null:new o.ASTImpl([...e,a],t,s.params,s.guards,c,f)}pType(){const e=[this.nextToken()],t=this.peekToken();if(l.NAME_BLACKLIST.includes(t.type))return this.newProblem(t,"ET0044");const n=this.pVariable();i(n);const r=this.peekToken();let s;return r.type==l.PlTokenType.LPAREN?(this.nextToken(),s=this.pParam(r,"ET0046","ET0047","CE0009").params):s=[],new o.ASTType(e,n,s)}pImport(){const e=[this.nextToken()],t=this.pPath();if(null==t)return null;e.push(...t[1]);let n=null,r=null;const s=this.peekToken();switch(s.type){case l.PlTokenType.AS:if(e.push(this.nextToken()),null==this.tryPeekToken(l.PlTokenType.VARIABLE,"ET0038",null))return null;n=this.pVariable(),i(n);break;case l.PlTokenType.SELECT:{e.push(this.nextToken());const t=this.peekToken();if(t.type==l.PlTokenType.MUL){e.push(this.nextToken()),r=[];break}if(t.type==l.PlTokenType.LF)return this.newProblemAt(s,"ET0041","after"),null;let n=this.pParam(s,"ET0039","ET0040","CE0006",l.PlTokenType.LF);if(null==n)return null;r=n.params;break}}return new o.ASTImport(e,t[0],n,r)}pExport(){const e=this.nextToken();if(this.peekMatch([l.PlTokenType.LF,l.PlTokenType.EOF]))return this.newProblem(e,"ET0020"),null;const t=this.pExpression();return null==t?null:new o.ASTExport([e],t)}pReturn(){const e=[this.nextToken()];if(this.peekToken().type==l.PlTokenType.LF)return new o.ASTReturn(e);const t=this.pExpression();return null==t?null:new o.ASTReturn(e,t)}pBreak(){return new o.ASTBreak([this.nextToken()])}pContinue(){return new o.ASTContinue([this.nextToken()])}pIf(){let e=[this.nextToken()],t=[],n=[],r=this.pExpression();if(null==r)return null;if(t.push(r),null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0021",r.getSpanToken()))return null;let s=this.pBlock();if(null==s)return null;for(n.push(s);;){const o=this.peekToken();if(o.type!=l.PlTokenType.ELIF)break;if(e.push(o),this.nextToken(),r=this.pExpression(),null==r)return null;if(t.push(r),null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0022",r.getSpanToken()))return null;if(s=this.pBlock(),null==s)return null;n.push(s)}let i=null;const u=this.peekToken();if(u.type==l.PlTokenType.ELSE){if(e.push(u),this.nextToken(),null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0023",u))return null;if(i=this.pBlock(),null==i)return null}return new o.ASTIf(e,t,n,i)}pEach(){const e=[this.nextToken()];if(null==this.tryPeekToken(l.PlTokenType.VARIABLE,"ET0024",null))return null;const t=this.pVariable();i(t);let n=null;if(this.peekToken().type==l.PlTokenType.COMMA){if(this.nextToken(),null==this.tryPeekToken(l.PlTokenType.VARIABLE,"ET0024",null))return null;n=this.pVariable(),i(n)}if(null==this.tryPeekToken(l.PlTokenType.OF,"ET0025",null==n?t.getSpanToken():n.getSpanToken()))return null;e.push(this.nextToken());const r=this.pExpression();if(null==r)return null;if(null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0025",r.getSpanToken()))return null;const s=this.pBlock();return null==s?null:new o.ASTEach(e,t,r,s,n)}pLoop(){const e=[this.nextToken()];let t=null;this.peekToken().type!=l.PlTokenType.LBRACE&&(t=this.pExpression());const n=null==t?e[0]:t.getSpanToken();if(null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0018",n))return null;const r=this.pBlock();return null==r?null:new o.ASTLoop(e,r,t)}pWhile(){const e=[this.nextToken()],t=this.pExpression();if(null==t)return null;if(null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0019",t.getSpanToken()))return null;const n=this.pBlock();return null==n?null:new o.ASTWhile(e,t,n)}pFor(){let e=[this.nextToken()],t=null,n=null,r=null;if(this.peekToken().type==l.PlTokenType.SEMICOLON)this.nextToken();else{if(t=this.pExpression(),null==t)return null;if(null==this.expectedPeekToken(l.PlTokenType.SEMICOLON,"ET0031",t.getSpanToken()))return null}if(this.peekToken().type==l.PlTokenType.SEMICOLON)this.nextToken();else{if(n=this.pExpression(),null==n)return null;if(null==this.expectedPeekToken(l.PlTokenType.SEMICOLON,"ET0031",n.getSpanToken()))return null}if(this.peekToken().type!=l.PlTokenType.LBRACE){if(r=this.pExpression(),null==r)return null;if(null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0032",r.getSpanToken()))return null}let s=this.pBlock();return null==s?null:new o.ASTFor(e,s,t,n,r)}pMatch(){let e=[this.nextToken()],t=null,n=[],r=[],s=null;if(this.peekToken().type!=l.PlTokenType.LBRACE&&(t=this.pExpression(),null==t))return null;const i=this.expectedPeekToken(l.PlTokenType.LBRACE,"ET0033",null==t?e[0]:t.getSpanToken());if(null!=i){for(;;){this.clearLF();let t=!1;const o=this.peekToken();switch(o.type){case l.PlTokenType.CASE:{e.push(this.nextToken());const t=this.pArgs(o,"ET0034","ET0035",l.PlTokenType.LBRACE,!1);if(null==t)return null;if(0==t[0].length)return this.newProblemAt(o,"LP0003","after"),null;const s=this.pBlock();if(null==s)return null;n.push(t[0]),r.push(s);break}case l.PlTokenType.DEFAULT:{if(null!=s)return this.newProblem(o,"LP0001"),null;if(e.push(this.nextToken()),null==this.tryPeekToken(l.PlTokenType.LBRACE,"ET0035",o))return null;const t=this.pBlock();if(null==t)return null;s=t;break}case l.PlTokenType.RBRACE:this.nextToken(),t=!0;break;default:return o.type==l.PlTokenType.LF||o.type==l.PlTokenType.EOF?this.newProblem(i,"CE0007"):this.newProblem(o,"ET0042"),null}if(t)break}return new o.ASTMatch(e,t,n,r,s)}}pExpression(){return this.pAssign()}pAssign(){const e=this.pLogical();if(null==e)return null;const n=this.peekToken();if(n.type==l.PlTokenType.ASGN){let r,l;if(e instanceof o.ASTVariable)r=null,l=e;else{if(!(e instanceof o.ASTDot)){if(e instanceof o.ASTCall&&e.target instanceof o.ASTDot&&"get"==e.target.right.content){this.nextToken();const t=e.target.left,r=e.args[0],l=this.pExpression();if(null==l)return null;const s=new o.ASTDot([n],t,new o.ASTVariable([n],"set"));return new o.ASTCall([n],s,[r,l])}return this.newProblem(e.getSpanToken(),"ET0002"),null}{let t=e;for(;t.right instanceof o.ASTDot;)t=t.right;r=e.left,l=t.right}}this.nextToken();const s=this.pExpression();return null==s?null:l.content.startsWith(t.CREATE_MAGIC)?(l.content=l.content.slice(1),new o.ASTCreate([n],r,l,s)):new o.ASTAssign([n],r,l,s)}return e}pLogical(){let e=this.pCompare();if(null==e)return null;for(;this.peekMatch([l.PlTokenType.AND,l.PlTokenType.OR]);){const t=this.nextToken(),n=this.pCompare();if(null==n)return null;e=new o.ASTBinary([t],e,n,t)}return e}pCompare(){let e=this.pPlus();if(null==e)return null;for(;this.peekMatch([l.PlTokenType.GT,l.PlTokenType.GTE,l.PlTokenType.LT,l.PlTokenType.LTE,l.PlTokenType.EQ,l.PlTokenType.NEQ]);){const t=this.nextToken(),n=this.pPlus();if(null==n)return null;e=new o.ASTBinary([t],e,n,t)}return e}pPlus(){let e=this.pMult();if(null==e)return null;for(;this.peekMatch([l.PlTokenType.ADD,l.PlTokenType.SUB]);){const t=this.nextToken(),n=this.pMult();if(null==n)return null;e=new o.ASTBinary([t],e,n,t)}return e}pMult(){let e=this.pPrefix();if(null==e)return null;for(;this.peekMatch([l.PlTokenType.MUL,l.PlTokenType.DIV]);){const t=this.nextToken(),n=this.pPrefix();if(null==n)return null;e=new o.ASTBinary([t],e,n,t)}return e}pPrefix(){if(this.peekMatch([l.PlTokenType.NOT,l.PlTokenType.ADD,l.PlTokenType.SUB])){const e=this.nextToken(),t=this.pPrefix();return null==t?t:new o.ASTUnary([e],e,t)}return this.pPostfix()}pPostfix(){let e=this.pCall();if(null==e)return null;for(;this.peekMatch([l.PlTokenType.INC,l.PlTokenType.DEC]);){if(!(e instanceof o.ASTVariable||e instanceof o.ASTUnary))return this.newProblem(e.getSpanToken(),"ET0005"),null;const t=this.nextToken();e=new o.ASTUnary([t],t,e)}return e}pCall(){let e=this.pPrimary();if(null==e)return null;for(;;){const t=this.peekToken();if(t.type==l.PlTokenType.LPAREN){this.nextToken();const n=this.pArgs(t,"ET0008");if(null==n)return null;e=new o.ASTCall([t],e,n[0]);continue}if(t.type==l.PlTokenType.DOT){this.nextToken();const n=this.peekToken();if(l.NAME_BLACKLIST.includes(n.type))return this.newProblem(n,"ET0003");const r=this.pVariable();i(r),e=new o.ASTDot([t],e,r);continue}if(t.type==l.PlTokenType.LBRACK){this.nextToken();const n=this.pExpression();if(null==n)return null;if(this.peekToken().type!=l.PlTokenType.RBRACK)return null;this.nextToken();const r=new o.ASTDot([t],e,new o.ASTVariable([t],"get"));e=new o.ASTCall([t],r,[n]);continue}const n=this.pArgsNoParen();if(null==n)return null;n[0].length>0&&(e=new o.ASTCall([t],e,n[0]));break}return e}pPrimary(){const e=this.peekToken();switch(e.type){case l.PlTokenType.LPAREN:return this.pGroup();case l.PlTokenType.VARIABLE:{this.nextToken();let t="";switch("list"==e.content?this.peekToken().type==l.PlTokenType.LPAREN&&(t="l"):"dict"==e.content&&this.peekToken().type==l.PlTokenType.LPAREN&&(t="d"),this.pushToken(e),t){case"l":return this.pList();case"d":return this.pDict();default:return this.pVariable()}}case l.PlTokenType.NUMBER:return this.pNumber();case l.PlTokenType.STR:return this.pString();case l.PlTokenType.BOOLEAN:return this.pBoolean();case l.PlTokenType.NULL:return this.pNull();case l.PlTokenType.FUNC:return this.pClosure()}return this.newProblem(e,"ET0004",e.content),null}pClosure(){const e=this.nextToken();if(null==this.expectedPeekToken(l.PlTokenType.LPAREN,"ET0014",e))return null;const t=this.pParam(e,"ET0016","ET0015");if(null==t)return null;let n;if(this.peekToken().type!=l.PlTokenType.LBRACE){const e=this.pExpression();if(null==e)return null;n=new o.ASTBlock([],[new o.ASTReturn([],e)])}else if(n=this.pBlock(),null==n)return null;return new o.ASTClosure([e],t.params,t.guards,n)}pVariable(){const e=this.nextToken(),t=l.PlTokenToPlVariable(e);return null==t?this.newProblem(e,"ET0048"):new o.ASTVariable([t],t.content)}pNumber(){const e=this.nextToken();return new o.ASTNumber([e],e.content)}pBoolean(){const e=this.nextToken();return new o.ASTBoolean([e],"true"==e.content?"1":"0")}pNull(){const e=this.nextToken();return new o.ASTNull([e])}pString(){const e=this.nextToken();return new o.ASTString([e],e.content)}pList(){let e=[this.nextToken()],t=this.expectedPeekToken(l.PlTokenType.LPAREN,"ET0007",e[0]);if(null==t)return null;e.push(t);const n=this.pArgs(t,"ET0006","CE0004");return null==n?null:new o.ASTList(e,n[0])}pDict(){let e=[this.nextToken()],t=this.expectedPeekToken(l.PlTokenType.LPAREN,"ET0010",e[0]);if(null==t)return null;e.push(t);let n=[],r=[];for(;;){this.clearLF();const e=this.peekToken();if(e.type==l.PlTokenType.RPAREN)break;if(e.type==l.PlTokenType.EOF)return this.newProblem(t,"CE0003"),null;const o=this.pPair();if(null==o)return null;this.clearLF();const s=this.peekToken();if(s.type==l.PlTokenType.COMMA)this.nextToken();else if(s.type!=l.PlTokenType.RPAREN)return this.newProblem(o[2].getSpanToken(),s.type==l.PlTokenType.EOF?"CE0003":"ET0012"),null;n.push(o[0]),r.push(o[2])}return this.nextToken(),new o.ASTDict(e,n,r)}pGroup(){const e=this.nextToken(),t=this.pExpression();return null==t||null==this.expectedPeekToken(l.PlTokenType.RPAREN,"CE0002",e)?null:t}pPair(){const e=this.peekToken();if(l.NAME_BLACKLIST.includes(e.type))return this.newProblem(e,"ET0009"),null;const t=this.pVariable();if(null==t)return null;i(t);const n=this.expectedPeekToken(l.PlTokenType.COLON,"ET0011",e);if(null==n)return null;const r=this.pExpression();return null==r?null:[t,n,r]}pArgs(e,t,n="CE0005",r=l.PlTokenType.RPAREN,o=!0){let s=[],i=[];for(;;){this.clearLF();const o=this.peekToken();if(o.type==r)break;if(o.type==l.PlTokenType.EOF)return this.newProblem(e,n),null;const u=this.pExpression();if(null==u)return null;this.clearLF();const a=this.peekToken();if(a.type==l.PlTokenType.COMMA)this.nextToken();else{if(a.type==l.PlTokenType.EOF)return this.newProblem(e,n),null;if(a.type!=r)return this.newProblemAt(u.getSpanToken(),t,"after"),null}i.push(a),s.push(u)}return o&&i.push(this.nextToken()),[s,i]}pArgsNoParen(){let e=[],t=[];for(;this.peekMatch([l.PlTokenType.VARIABLE,l.PlTokenType.STR,l.PlTokenType.BOOLEAN,l.PlTokenType.NUMBER,l.PlTokenType.TYPE,l.PlTokenType.FUNC,l.PlTokenType.NOT,l.PlTokenType.NULL]);){const n=this.pExpression();if(null==n)return null;e.push(n);const r=this.peekToken();if(r.type!=l.PlTokenType.COMMA)break;this.nextToken(),t.push(r)}return[e,t]}pParam(e,t,n,r="CE0006",o=l.PlTokenType.RPAREN,s=!1){let u=[],a=[],c=[];for(;s||this.clearLF(),this.peekToken().type!=o;){const f=this.peekToken();if(f.type==l.PlTokenType.EOF)return this.newProblem(f,n),null;const p=this.pVariable();i(p),s||this.clearLF();let T=this.peekToken();if(T.type==l.PlTokenType.COLON){this.nextToken();const e=this.pVariable();if(null==e)return null;c.push(e),T=this.peekToken()}else c.push(null);if(T.type==l.PlTokenType.COMMA)this.nextToken();else{if(T.type==l.PlTokenType.EOF)return this.newProblem(e,r),null;if(T.type!=o)return this.newProblem(T,t),null}a.push(T),u.push(p)}return s||a.push(this.nextToken()),{params:u,guards:c,tokens:a}}pPath(){let e=[],t=[];for(;;){let n=this.peekToken();switch(n.type){case l.PlTokenType.VARIABLE:{const e=this.pVariable();if(null==e)return null;t.push(e);break}case l.PlTokenType.DOT:{this.nextToken();let e=n;const r=this.peekToken();r.type==l.PlTokenType.DOT&&(this.nextToken(),e=o.CreateSpanToken(n,r)),t.push(new o.ASTVariable([e],e.content));break}default:return this.newProblem(n,"ET0036"),null}let r=!1;switch(n=this.peekToken(),n.type){case l.PlTokenType.DIV:e.push(this.nextToken());break;case l.PlTokenType.AS:case l.PlTokenType.SELECT:case l.PlTokenType.LF:case l.PlTokenType.EOF:r=!0;break;default:return this.newProblemAt(t[t.length-1].getSpanToken(),"ET0037","after"),null}if(r)break}return[t,e]}}},6517:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsPreLower=t.IsPreHigher=void 0;const r=n(3550),o={[r.PlTokenType.ASGN]:0,[r.PlTokenType.AND]:1,[r.PlTokenType.OR]:1,[r.PlTokenType.LT]:2,[r.PlTokenType.LTE]:2,[r.PlTokenType.GT]:2,[r.PlTokenType.GTE]:2,[r.PlTokenType.EQ]:2,[r.PlTokenType.NEQ]:2,[r.PlTokenType.ADD]:3,[r.PlTokenType.SUB]:3,[r.PlTokenType.MUL]:4,[r.PlTokenType.DIV]:4};t.IsPreHigher=function(e,t){return e in o&&t in o&&o[t]>o[e]},t.IsPreLower=function(e,t){return e in o&&t in o&&o[t]<o[e]}},866:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ASTProgramToString=t.HIGHLIGHT=void 0;const r=n(4538),o=n(3550),l=n(2543),s=n(6517);t.HIGHLIGHT={kw:"magenta",sr:"green",mt:"yellow",nu:"cyan",op:"white"};let i={kw:l.colors[t.HIGHLIGHT.kw],sr:l.colors[t.HIGHLIGHT.sr],mt:l.colors[t.HIGHLIGHT.mt],nu:l.colors[t.HIGHLIGHT.nu],op:l.colors[t.HIGHLIGHT.op]};function u(e,t=4){return e.split("\n").map((e=>" ".repeat(t)+e)).join("\n")}function a(e,t=", "){return e.map((e=>c(e))).join(t)}function c(e){if(null==e)return"";if(e instanceof r.ASTBlock)return 0==e.statements.length?"{}":`{\n${e.statements.map((e=>u(c(e)))).join("\n")}\n}`;if(e instanceof r.ASTBinary){const t=c(e.left),n=c(e.right);return e.left instanceof r.ASTBinary&&s.IsPreLower(e.operator.type,e.left.operator.type)?`(${t}) ${e.operator.content} ${n}`:`${t} ${e.operator.content} ${n}`}if(e instanceof r.ASTUnary){const t=c(e.value),n=e.operator;return n.type==o.PlTokenType.INC||n.type==o.PlTokenType.DEC?`${t}${n.content}`:n.type==o.PlTokenType.NOT?`${n.content} ${t}`:`${n.content}${t}`}if(e instanceof r.ASTList)return`${i.mt("list")}(${e.values.map((e=>c(e))).join(", ")})`;if(e instanceof r.ASTDict)return`${i.mt("dict")}(\n${u(e.keys.map(((t,n)=>c(t)+": "+c(e.values[n]))).join(",\n"))}\n)`;if(e instanceof r.ASTType)return`${i.kw("type")} ${c(e.name)} (\n${u(e.members.map((e=>c(e))).join(",\n"))}\n)`;if(e instanceof r.ASTCall)return e.target instanceof r.ASTDot?`${c(e.target.left)}.${i.mt(c(e.target.right))}(${e.args.map((e=>c(e))).join(", ")})`:`${i.mt(c(e.target))}(${e.args.map((e=>c(e))).join(", ")})`;if(e instanceof r.ASTAssign){let t="";return e.pre&&(t+=c(e.pre)+"."),t+=`${c(e.variable)} = ${c(e.value)}`,t}if(e instanceof r.ASTDot)return`${c(e.left)}.${c(e.right)}`;if(e instanceof r.ASTFunction)return`${i.kw("func")} ${c(e.name)}(${a(e.args)}) ${c(e.block)}`;if(e instanceof r.ASTImpl)return`${i.kw("impl")} ${c(e.name)}(${a(e.args)}) ${i.kw("for")} ${c(e.target)} ${c(e.block)}`;if(e instanceof r.ASTImport){let t=`${i.kw("import")} ${a(e.path,"/")}`;return e.alias?t+=` ${i.kw("as")} ${c(e.alias)}`:e.select&&(t+=` ${i.kw("select")} ${a(e.select)}`,0==e.select.length&&(t+="*")),t}if(e instanceof r.ASTExport)return`${i.kw("export")} ${c(e.content)}`;if(e instanceof r.ASTReturn)return`${i.kw("return")} ${c(e.content)}`;if(e instanceof r.ASTIf){let t=e.conditions.map(((t,n)=>{let r=`${c(t)} ${c(e.blocks[n])}`;return r=0==n?i.kw("if")+" "+r:i.kw("elif")+" "+r,r})).join(" ");return e.other&&(t+=` ${i.kw("else")} ${c(e.other)}`),t}if(e instanceof r.ASTEach){let t=`${i.kw("each")} ${c(e.value)}`;return e.key&&(t+=`, ${c(e.key)}`),t+` ${i.kw("in")} ${c(e.iterator)} ${c(e.block)}`}if(e instanceof r.ASTLoop){let t=`${i.kw("loop")}`;return e.amount&&(t+=` ${c(e.amount)}`),t+` ${c(e.block)}`}if(e instanceof r.ASTWhile)return`${i.kw("while")} ${c(e.condition)} ${c(e.block)}`;if(e instanceof r.ASTFor)return`${i.kw("for")} ${c(e.start)}; ${c(e.condition)}; ${c(e.after)} ${c(e.block)}`;if(e instanceof r.ASTMatch){let t=e.cases.map(((t,n)=>u(`${i.kw("case")} ${a(t)} ${c(e.blocks[n])}`))).join("\n"),n="";return e.other&&(n=u(`\n${i.kw("default")} ${c(e.other)}`)),`${i.kw("match")} ${c(e.value)} {\n${t}${n}\n}`}return e instanceof r.ASTString?i.sr(`"${e.content}"`):e instanceof r.ASTClosure?`${i.kw("func")}(${a(e.args)}) ${c(e.block)}`:e instanceof r.ASTNumber?i.nu(e.value):e instanceof r.ASTBreak||e instanceof r.ASTContinue?i.kw(e.getSpanToken().content):e.getSpanToken().content}t.ASTProgramToString=function(e){return e.map((e=>c(e))).join("\n\n")}},1624:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.capitalize=t.shallowJSON=t.lineWrap=t.dddString=t.chunkString=t.escapeString=t.replaceForAll=void 0;const r=n(5061);t.replaceForAll=function(e,t,n){return e.split(t).join(n)},t.escapeString=function(e){return e.split("").map((e=>r.isalphanum(e)?e:function(e){switch(e){case"\n":return"\\n";case"\r":case"\t":return"\\r";case"\f":return"\\f";default:return e}}(e))).join("")},t.chunkString=function(e,t){var n,r,o=[];for(n=0,r=e.length;n<r;n+=t)o.push(e.substr(n,t));return 0==o.length&&o.push(""),o},t.dddString=function(e,t=20){return e.length<=t?e:e.substring(0,t-3)+"..."},t.lineWrap=function(e,t){return e.replace(new RegExp(`(?![^\\n]{1,${t}}$)([^\\n]{1,${t}})\\s`,"g"),"$1\n")},t.shallowJSON=function(e){return JSON.stringify(e,(function(e,t){return e&&t&&"number"!=typeof t?Array.isArray(t)?`[array ${t.length}]`:""+t:t}),2)},t.capitalize=function(e){return e[0].toUpperCase()+e.slice(1)}},8487:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tsEnumKeys=void 0,t.tsEnumKeys=function(e){const t=[];for(const n in e)parseInt(n,10)>=0&&t.push(e[n]);return t}},5061:(e,t)=>{"use strict";function n(e){return e>="0"&&e<="9"}function r(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function o(e){return r(e)||n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isvariablerest=t.isvariablefirst=t.tonum=t.iscap=t.isalphanum=t.isalpha=t.isnum=t.isblank=t.isws=void 0,t.isws=function(e){return" "===e||"\t"===e||"\r"===e||"\n"===e||"\f"===e},t.isblank=function(e){return" "===e||"\t"===e},t.isnum=n,t.isalpha=r,t.isalphanum=o,t.iscap=function(e){return e>="A"&&e<="Z"},t.tonum=function(e){return e-"0"},t.isvariablefirst=function(e){return r(e)||"_"===e||"@"===e||"$"===e},t.isvariablerest=function(e){return o(e)||"?"==e||"_"==e||"!"==e}},773:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlBuffer=void 0,t.PlBuffer=class{constructor(e=5){this.limit=e,this.buffer=[]}push(e){return this.buffer.push(e),this.buffer.length>this.limit}isEmpty(){return 0===this.buffer.length}empty(){const e=this.buffer;return this.buffer=[],e}}},2543:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetColorNone=t.SetColorHTML=t.SetColorNode=t.colors=void 0;const r=n(6962),o=["black","red","green","yellow","blue","magenta","cyan","white"];function l(){t.colors=function(e){const t=(e,t)=>`[${e}m${t}[39m`,n={grey:t.bind(null,90)};for(let r=0;r<e.length;r++)n[e[r]]=t.bind(null,30+r);return n}(o)}function s(){t.colors={};for(const e of[...o,"grey"])t.colors[e]=t=>`<span\\style='color:${e}'>${t}</span>`}r.isNode?l():s(),t.SetColorNode=l,t.SetColorHTML=s,t.SetColorNone=function(){t.colors={};for(const e of[...o,"grey"])t.colors[e]=e=>e}},2051:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewPlFile=void 0;const r=n(1624);t.NewPlFile=function(e,t){return{filename:e,content:t=function(e){return e=r.replaceForAll(e,"\r\n","\n"),e=r.replaceForAll(e,"\r","\n"),r.replaceForAll(e,"\t","    ")}(t)}}},6962:(e,t,n)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.Inout=t.ChangeInout=t.isNode=void 0,t.isNode="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,r=t.isNode?n(1060):n(186),t.ChangeInout=function(e){r=Object.assign(Object.assign({},r),e)},t.Inout=()=>r},1060:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.options=t.execute=t.readFile=t.setRootPath=t.paths=t.input=t.flush=t.print=void 0;const r=n(5747),o=n(5622),l=n(2852),s=n(8887),i=n(7887),u=l({history:s(),autocomplete:(a="func impl import for as select export return break continue if elif else each loop while match case default and or not in print input list dict true false null Int Str Null List Dict Func Type".split(" "),function(e){if(0==e.length)return[];let t=[];for(let n=0;n<a.length;n++){if(a[n]==e)return[];0==a[n].indexOf(e)&&t.push(a[n])}return t})});var a;t.print=function(e){console.log(e)},t.flush=function(){},t.input=function(e){return u(e)},t.paths={cliPath:process.cwd(),exePath:process.execPath,rootPath:process.execPath},t.setRootPath=function(e){t.paths.rootPath=o.join(t.paths.cliPath,o.dirname(e))},t.readFile=function(e,n){try{const l=o.join(t.paths[n],e);return r.readFileSync(l,{encoding:"utf8",flag:"r"})}catch(e){return null}},t.execute=function(e,r){i.MaskedEval(e,Object.assign({console,Math,Date,Object,Number,Array,String,Function,Boolean,Symbol,Error,BigInt,RegExp,Map,Set,JSON,Promise,require:e=>n(4470)(o.join(t.paths.rootPath,e)),global},r))},t.options={mode:"debug",run:"file"}},186:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.options=t.execute=t.readFile=t.setRootPath=t.paths=t.flush=t.input=t.print=void 0;const r=n(773),o=n(7887),l=new r.PlBuffer;function s(){l.isEmpty()||alert(l.empty().join("\n"))}t.print=function(e){l.push(e)&&alert(l.empty().join("\n"))},t.input=function(e){return s(),prompt(e)},t.flush=s,t.paths={cliPath:"/",exePath:"/",rootPath:"/"},t.setRootPath=function(e){t.paths.rootPath=e},t.readFile=function(e,t){return null},t.execute=function(e,t){o.MaskedEval(e,Object.assign({console,Math,Date,Object,Number,Array,String,Function,Boolean,Symbol,Error,RegExp,Map,Set,JSON,Promise,document,window,navigator},t))},t.options={mode:"debug",run:"file"}},7887:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaskedEval=void 0,t.MaskedEval=function(e,t={}){t=new Proxy(t,{has:()=>!0}),new Function("with(this) { "+e+"}").call(t)}},181:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFile=t.RunVM=t.RunVmFast=t.RunFile=t.RunOnce=t.RunHighlighter=t.TryRunParser=t.RunEmitter=t.RunParser=void 0;const r=n(4098),o=n(6734),l=n(2051),s=n(6962),i=n(4619),u=n(1609),a=n(1176),c=n(50),f=n(2585);function p(e){const t=new r.default(e),n=new i.PlAstParser(t),l=n.parseAll(),s=n.getProblems();return 0!=s.length?(o.ReportProblems(e.content,s),null):l}t.RunParser=p,t.RunEmitter=function(e){let t=p(e);return null==t?null:(t=f.OptimizeProgram(t),u.EmitProgram(t,!0))},t.TryRunParser=function(e){const t=new r.default(e),n=new i.PlAstParser(t);return null==n.parseAll()?n.getProblems():null},t.RunHighlighter=function(e){const t=new r.default(e),n=new i.PlAstParser(t),l=n.parseAll(),u=n.getProblems();if(0!=u.length)return void o.ReportProblems(e.content,u);const a=c.ASTProgramToColorRegions(l),f=c.ASTProgramHighlight(a,e.content);s.Inout().print(f)},t.RunOnce=function(e,t){const n=new r.default(t),l=new i.PlAstParser(n);let s=l.parseAll();if(null==s){const e=l.getProblems();return o.ReportProblems(t.content,e),null}s=f.OptimizeProgram(s);const a=u.EmitProgram(s);a.program.pop();for(const t of a.debug)t.endLine+=e.program.program.length;if(e.addProgram(a,t.content),null==e.runProgram()){const n=e.getTrace(),r=e.getProblems();return o.ReportProblems(t.content,r,n),null}return e.popStack()},t.RunFile=function(e,t){const n=new r.default(t),l=new i.PlAstParser(n);let a=l.parseAll();if(null==a){const e=l.getProblems();return o.ReportProblems(t.content,e),null}a=f.OptimizeProgram(a);const c=u.EmitProgram(a);for(const t of c.debug)t.endLine+=e.program.program.length;e.addProgram(c,t.content);const p=e.runProgram();if(null==p){const n=e.getTrace(),r=e.getProblems();return o.ReportProblems(t.content,r,n),1}return s.Inout().flush(),"number"==typeof p.value?p.value:0},t.RunVmFast=function(e,t){const n=new r.default(e),l=new i.PlAstParser(n),c=new a.PlStackMachine(Object.assign(Object.assign({},s.Inout()),{print:e=>{s.Inout().print(e),s.Inout().flush()}}),e,t);let f=null;for(;!l.isEOF();){const t=l.parseOnce();if(null==t){const t=l.getProblems();return o.ReportProblems(e.content,t),1}if(c.addProgram(u.EmitStatement(t)),f=c.runProgram(),null==f){const t=c.getTrace(),n=c.getProblems();return o.ReportProblems(e.content,n,t),1}}return"number"==typeof f.value?f.value:0},t.RunVM=function(e,t){const n=new r.default(e),l=new i.PlAstParser(n);let c=l.parseAll();if(null==c){const t=l.getProblems();return o.ReportProblems(e.content,t),1}c=f.OptimizeProgram(c);const p=u.EmitProgram(c,!0),T=new a.PlStackMachine(Object.assign(Object.assign({},s.Inout()),{print:e=>{s.Inout().print(e),s.Inout().flush()}}),e,t);T.addProgram(p);const h=T.runProgram();if(null==h){const t=T.getTrace(),n=T.getProblems();return o.ReportProblems(e.content,n,t),1}return s.Inout().flush(),"number"==typeof h.value?h.value:0},t.ReadFile=function(e){const t=n(5622);s.Inout().setRootPath(e);const r=t.basename(e);let o;if(t.isAbsolute(e))try{o=n(5747).readFileSync(e).toString()}catch(e){o=null}else o=s.Inout().readFile(r,"rootPath");return null===o?(s.Inout().print(`Cannot read file '${e}'`),s.Inout().print("Reason: file doesn't exist or can't be read"),s.Inout().flush(),null):l.NewPlFile(r,o)}},1888:(e,t)=>{"use strict";function n(e="left brace '{'",t="'here' is pointing to"){return`simply put a ${e} after where ${t}`}function r(e){return`I need a ${e}, sticking to the english alphabet is the best bet here`}function o(e){return`${e}, try putting one after 'here'`}function l(e,t,n){return`${e} have the following syntax:\n${t}\nI found that you are missing ${n}`}function s(e,t){return`${e}(s) not closed, try adding ${t}`}Object.defineProperty(t,"__esModule",{value:!0}),t.PCFullName=t.PCHint=void 0;const i={LE0001:"I do not understand this character, try removing it",LE0002:s("string","a closing '\"'"),LE0003:"if you intended to type '\\', write two forward-slashes '\\\\' to escape the first slash",LE0004:"string replacement parens not closed, try adding a closing ')'",ET0001:"a newline or ';' is needed between statements - this might also be a syntax error",ET0002:"the left side of '=' must be a variable",ET0003:"to access field(s) that contain symbols, try '<t>.get(<key>)'",ET0004:"this expression have the wrong syntax, take a look at the documentation to see what is the valid syntax for Deviation",ET0005:"'++' and '--' cannot be used on expressions, I can only increase or decrease variables",ET0006:"list items are separated by ',', try putting one after 'here'",ET0007:n("left paren '('"),ET0008:"evoking arguments are separated by ',', try putting one after 'here'",ET0009:"a dictionary needs keys that are valid variables, I cannot set operators or symbols as keys of the dictionary",ET0010:n("left paren '('"),ET0011:o("a dictionary key,value pair is separated with ':'"),ET0012:o("dictionary key,value pairs are separated by ','"),ET0013:r("valid variable name to name the function"),ET0014:"function parameters are separated by ',', try putting one after 'here'. And if the function doesn't take any parameters, place an empty set of '()' after the function name",ET0015:r("valid name for the parameters of a (type) function"),ET0016:o("(type) function parameters are separated by ','"),ET0017:n(),ET0018:n(),ET0019:n(),ET0020:"you cannot export nothing. To export every thing, remove this statement",ET0021:n(),ET0022:n(),ET0023:n(),ET0024:r("valid name for the value and key in a each..of statement"),ET0025:l("an each..of statement","each value, key of target {}","the 'of' keyword"),ET0026:n(),ET0027:r("valid variable name to name the type function"),ET0028:n("a parenthesis '('"),ET0029:l("an impl statement","impl hello(self) for Num {}","the 'for' keyword"),ET0030:n(),ET0043:l("an impl statement","impl hello(self) for Num {}","a type after the 'for' keyword"),ET0031:"the conditions of a for loop needs to be separated by semicolons ';', simply put one after 'here'",ET0032:n(),ET0033:n(),ET0034:o("match case options must be separated by ','"),ET0035:n(),ET0042:l("a match statement","match item {\n    case 1, 2 {}\n}","the keyword 'case' or 'default' here"),ET0036:"a correct path is made of variables or . or .. separated by a slash '/'",ET0037:"maybe check your import syntax",ET0038:"an alias must be a valid variable that begins with an underscore '_' or a character",ET0039:"import select variables must have a comma ',' between them",ET0040:"import select variables must be valid variables",ET0041:"you cannot select no variables, if importing all variables are needed, try the 'select *' syntax",ET0044:r("valid variable name to name the type"),ET0045:n("left parenthesis '('"),ET0046:o("type members are separated with ','"),ET0047:r("valid variable name for the type members"),ET0048:"",CE0001:s("blocks","a closing '}'"),CE0002:s("groups","a closing ')'"),CE0003:s("dictionary","a closing ')'"),CE0004:s("list","a closing ')'"),CE0005:s("argument list","a closing ')'"),CE0006:s("parameter list","a closing ')'"),CE0007:s("match statement","a closing '}'"),CE0008:s("multiline string",'a closing \'"""\''),CE0009:s("type member","a closing ')'"),LP0001:"there can be only one default block in a match statement, try removing all other default cases",LP0002:"the first parameter in an impl statement is by convention 'self'",LP0003:"a case statement with no expressions will match nothing, if matching nothing is intended, try the 'default {}' syntax",DE0001:"the developer made a mistake, please report this",DE0002:"the developer made a mistake, please report this",RE0001:"there is an unknown bytecode in the program, please report this",RE0002:"try running the interpreter with '--mode-debug' flag",RE0003:"this variable is not defined anywhere that I've looked",RE0004:"I cannot do this operation with these types",RE0005:"I can only negate numbers",RE0006:"check the number of arguments for the function call, there might be a few missing or a few extras",RE0007:"a function panicked, the message is below",RE0008:"I can only call a function, what the value that is stored in this variable?",RE0009:"the keywords 'continue' and 'break' needs to be used inside a loop",RE0010:"I saw a jump instruction but the value is not a boolean",RE0011:"I need a number as the amount of times to run this loop statement",RE0012:"I cannot find this key in the value, maybe check your spelling?",RE0013:"I cannot assign to a non dictionary or type target, if you are trying to make a new type function, try the 'impl' statement",RE0014:"I want a boolean here",RE0015:"I can only increment or decrement numbers",RE0016:"only a value with the '.iter' type function can be used for an each..of loop",RE0017:"I can only 'negate' booleans",RE0018:"is the type what you expected?",RE0019:"this guard is not defined anywhere that I've looked"},u={LE:"LexerError",ET:"BadToken",CE:"ClosingError",LP:"LogicalProblem",DE:"DevError",RE:"ExeProblem"};t.PCHint=function(e){const t=i[e];return 0==t.length?"there are no hints":t},t.PCFullName=function(e){return u[e.substring(0,2)]},t.default={LE0001:"unrecognized character '%0'",LE0002:"reached newline with unclosed double quote",LE0003:"unrecognized escape sequence '%0'",LE0004:"reached newline with unclosed left parenthesis",ET0001:"expected a newline or ';' after a statement",ET0002:"expected a variable on the left side of assignment",ET0003:"expected a variable after the dot",ET0004:"unexpected character '%0' during expression",ET0005:"expected a variable before postfix operators",ET0006:"expected ',' between list items",ET0007:"expected '(' when creating a list",ET0008:"expected ',' between function arguments",ET0009:"expected a variable as the key in a dictionary",ET0010:"expected  '(' when creating a dictionary",ET0011:"expected ':' between dictionary pairs",ET0012:"expected ',' between dictionary pairs",ET0013:"expected a name in a function definition",ET0014:"expected '(' around the function parameters",ET0015:"expected variables for function or impl parameters",ET0016:"expected ',' between function or impl parameters",ET0017:"expected '{' after function or impl parameters",ET0018:"expected '{' after loop keyword or amount",ET0019:"expected '{' after while loop conditions",ET0020:"expected an expression after export",ET0021:"expected '{' after if conditions",ET0022:"expected '{' after elif conditions",ET0023:"expected '{' after else",ET0024:"expected variables for the value or key in each..of statement",ET0025:"expected keyword 'of' in each..of statement",ET0026:"expected '{' after each..of statement",ET0027:"expected a variable as the imply name",ET0028:"expected '(' around impl parameters",ET0029:"expected keyword 'for' after impl parameters",ET0030:"expected '{' after impl definitions",ET0043:"expected a target type in an impl definition",ET0031:"expected ';' between pre-condition-post expressions",ET0032:"expected '{' after for-loop expressions",ET0033:"expected '{' after match or match value",ET0034:"expected ':' between case expressions in a match",ET0035:"expected '{' after a keyword default or a case expression",ET0042:"expected keyword 'case' or 'default' in a match statement",ET0036:"expected a correct path in an import statement",ET0037:"expected the keyword select, as, or newline after an import path",ET0038:"expected variable name for an import alias",ET0039:"expected commas between import select variables",ET0040:"expected variables for import select items",ET0041:"expected at least one select item in an import statement",ET0044:"expected a variable as the type name",ET0045:"expected '(' after the keyword 'type'",ET0046:"expected ',' between type members",ET0047:"expected variables for type members",ET0048:"expected a variable",CE0001:"reached newline with unclosed '}'",CE0002:"reached newline with unclosed ')'",CE0003:"reached newline with unclosed ')'",CE0004:"reached newline with unclosed ')'",CE0005:"reached newline with unclosed ')'",CE0006:"reached newline with unclosed ')'",CE0007:"reached newline with unclosed '}'",CE0008:'reached newline with unclosed \'"""\'',CE0009:"reached newline with unclosed ')'",LP0001:"more than one default cases in a match statement",LP0002:"zero parameters for an impl definition",LP0003:"no conditions for a case statement",DE0001:"problem during compiling\n%0",DE0002:"problem during interpreting\n%0",RE0001:"encountered unknown bytecode: '%0'",RE0002:"problem on line '%0'",RE0003:"no variable named '%0' found",RE0004:"no function '%0' on type '%1'",RE0005:"cannot negate '%0'",RE0006:"incorrect arity for a function call, needs %0 but got %1",RE0007:"%0",RE0008:"calling an uncallable value of type '%0'",RE0009:"'continue' or 'break' used outside a loop",RE0010:"not a boolean needed for jump, got type '%0'",RE0011:"non numeral loop iterations of type '%0'",RE0012:"no key '%0' on target of type '%1'",RE0013:"cannot assign to target of type '%0'",RE0014:"not a boolean, got type '%0'",RE0015:"not a number, got type '%0'",RE0016:"need '.%0' type function on value of type '%1'",RE0017:"use of 'not' on a non-boolean value of type '%0'",RE0018:"'%1' argument failed to satisfy '%0', got '%2' instead",RE0019:"no parameter guard named '%0' found"}},6734:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReportCallbackProblems=t.ReportProblems=t.ReportProblem=void 0;const r=n(5469),o=n(6962),l=n(2543);t.ReportProblem=function(e,t){o.Inout().print(l.colors.red("Problem(s) Occurred")),o.Inout().print(r.LogProblem(e,t)),o.Inout().flush()},t.ReportProblems=function(e,t,n){o.Inout().print(l.colors.red("Problem(s) Occurred")),n&&n.length>2&&(o.Inout().print(l.colors.red("Callframes (Most Recent Last)")),o.Inout().print(r.LogTrace(n)),o.Inout().print(""));try{for(const n of t)o.Inout().print(r.LogProblem(n,e))}catch(e){return o.Inout().print(`${l.colors.red("Exception")} in reporting the problems: ${e}`),o.Inout().print("This is a developer error, please report this to him"),o.Inout().flush(),!1}return"debug"!=o.Inout().options.mode&&o.Inout().print(l.colors.green("\nTo see a more detailed error, pass '--mode-debug' when running from cli")),o.Inout().flush(),!0},t.ReportCallbackProblems=function(e,t){o.Inout().print(l.colors.red("Callback Problem(s) Occurred")),0==t.length?o.Inout().print(l.colors.red("No Callframes")):(o.Inout().print(l.colors.red("Callframes:")),o.Inout().print(r.LogTrace(t))),o.Inout().print("");try{o.Inout().print(r.LogCallbackProblem(e))}catch(e){return o.Inout().print(`Exception in reporting the problems: ${e}`),o.Inout().print("This is a developer error, please report this to him"),o.Inout().flush(),!1}return o.Inout().flush(),!0}},3836:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{u(r.next(e))}catch(e){l(e)}}function i(e){try{u(r.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.IACTDebugger=void 0;const o=n(3607),l=n(1624),s=n(1609),i=n(4214),u=n(5473),a=n(8968);var c=o.PlConverter.PlToString,f=o.PlConverter.PlToDebugString;const p=n(2051),T=n(4619),h=n(4098);let y=!1;t.IACTDebugger=function(e){return r(this,void 0,void 0,(function*(){if(e.stack.push(null),y)return Promise.resolve(null);y=!0;const t=n(7245),r="win32"==process.platform,d="{yellow-fg}[F]{/}",P=e=>e.startsWith(d)?e:`${d} ${e}`,S=e=>e.startsWith(d)?e.substring(d.length+1):e;let m={selected:{bg:"grey",fg:"white"},scrollbar:{bg:"grey"}};return r&&(m={selected:{bg:"cyan",fg:"white"},scrollbar:{bg:"cyan"}}),new Promise((n=>{const g=t.screen({smartCSR:!0,title:"Interactive Debugger"}),k=t.box({parent:g,top:0,left:0,tags:!0,content:"{bold}Interactive Debugger{/bold} Press 'Ctrl-C' or 'q' to exit\nPress 'Up' and 'Down' to choose the callframes and locals, press 'Enter' to select",shrink:!0});r?k.setContent(k.getContent()+"\n[F] shows the focused panel, press 'Tab' to switch panels"):k.setContent(k.getContent()+"\nClick on a panel to focus it");const b=k.content.split("\n").length,w=t.box({parent:g,top:b,left:0,height:3,label:"{bold}Functions{/}",border:"line",tags:!0,padding:{left:1,right:1}}),E=t.button({parent:w,content:"Step [N]",height:1,top:0,left:0,mouse:!0,shrink:!0,style:{fg:"green",focus:{fg:"white"}}});let N=e.pointer,v=null;for(const t of e.program.debug)N<=t.endLine&&N>=t.endLine-t.length&&(null==v||v.length>t.length)&&(v=t);const F=function(){const t=e.program.program;if(t[e.pointer].type==a.PlBytecodeType.DORETN)return;const n=v.span.info.row;let r=0,o=e.saveState(),l=!0;const s=e.runProgram(e.pointer,((s,i)=>{if(l)return l=!1,!1;const c=t[s];if(c.type==a.PlBytecodeType.DOCALL){const e=o.stack[o.stack.length-1];e&&e.type==u.PlStuffType.Func&&(r+=1)}const f=t[i];if([a.PlBytecodeType.JMPREL,a.PlBytecodeType.STKEXT,a.PlBytecodeType.STKENT].includes(f.type))return!1;if(c.type==a.PlBytecodeType.DORETN)r>0&&(r-=1);else if((c.type==a.PlBytecodeType.STKPOP||c.type==a.PlBytecodeType.JMPICF)&&r<=0){let t=null;for(const r of e.program.debug)if(i<=r.endLine&&r.endLine-r.length<=i&&r.span.info.row!=n){(null==t||r.length<t.length)&&(t=r);break}return!!(t&&"ASTCondition"!=t.name&&t.span.info.filename.length>0)&&(v=t,N=i,!0)}return o=e.saveState(),!1}));if(0!=e.problems.length)throw re(),null;if(null!=s)return"number"==typeof s.value?re(s.value):re(0);R(),$(),W()};E.on("press",F),g.key(["n"],F);const A=t.button({parent:w,content:"Step Into [M]",height:1,top:0,left:E.content.length+2,mouse:!0,shrink:!0,style:{fg:"green",focus:{fg:"white"}}}),O=function(){const t=e.program.program;if(t[e.pointer].type==a.PlBytecodeType.DORETN)return;const n=v.span.info.row;let r=e.saveState(),o=!0;const l=e.runProgram(e.pointer,((l,s)=>{if(o)return o=!1,!1;const i=t[l],u=t[s];if([a.PlBytecodeType.JMPREL,a.PlBytecodeType.STKEXT,a.PlBytecodeType.STKENT].includes(u.type))return!1;if(i.type==a.PlBytecodeType.STKPOP||i.type==a.PlBytecodeType.JMPICF){let t=null;for(const r of e.program.debug)if(s<=r.endLine&&r.endLine-r.length<=s&&r.span.info.row!=n){(null==t||r.length<t.length)&&(t=r);break}return!!(t&&"ASTCondition"!=t.name&&t.span.info.filename.length>0)&&(v=t,N=s,!0)}return r=e.saveState(),!1}));if(0!=e.problems.length)throw re(),null;if(null!=l)return"number"==typeof l.value?re(l.value):re(0);R(),$(),W()};A.on("press",O),g.key(["m"],O);const B=`100%-${b+3}`,C=`"${e.file.filename}"`,L=t.box({parent:g,bottom:0,left:0,tags:!0,keys:!0,scrollable:!0,alwaysScroll:!0,scrollbar:{style:Object.assign({},m.scrollbar)},label:C,width:"75%",height:B,border:"line",padding:{left:1,right:1},style:{focus:{scrollbar:{bg:"white"}}}});L.data.label=C;const R=function(){const t=e.file.content.split("\n"),n=(""+t.length).length,r=t.map(((e,t)=>{const r=`${" ".repeat(n-(""+(t+=1)).length)}${t}|  ${e}`;return v.span.info.row+1==t?`{red-bg}{white-fg}${r}{/white-fg}{/red-bg}`:r})).join("\n");L.setContent(r),L.setScroll(v.span.info.row-1),g.render()};R();const D=t.box({parent:g,bottom:0,left:"75%",tags:!0,width:"25%",height:B}),I="{bold}Callframes{/bold}",x=t.box({parent:D,label:I,tags:!0,height:"35%",border:"line",padding:{left:1,right:1}});x.data.label=I;const G=t.list({parent:x,top:0,left:0,height:"100%-2",scrollable:!0,alwaysScroll:!0,scrollbar:{style:Object.assign({},m.scrollbar)},style:{focus:{scrollbar:{bg:"white"}},selected:Object.assign({},m.selected)},keys:!0,tags:!0});let M,j;const $=function(){G.clearItems();const t=[];j=e.getFrames(),j.reverse();for(const e of j)e.trace?null==e.trace.info?t.push(`'${e.trace.name}'`):t.push(`'${e.trace.name}' at line ${e.trace.info.row+1}`):t.push("|frame|");G.setItems(t),G.select(j.length-1),M=j[j.length-1],g.render()};G.on("select",(function(e,t){M=j[t],W()})),$();const _="{bold}Locals{/bold}",V=t.text({parent:D,height:"65%+1",top:"35%",left:0,label:_,tags:!0,border:"line",padding:{left:1,right:1}});V.data.label=_;const H=t.list({parent:V,height:"100%-2",top:0,left:0,scrollable:!0,alwaysScroll:!0,tags:!0,scrollbar:{style:Object.assign({},m.scrollbar)},style:{focus:{scrollbar:{bg:"white"}},selected:Object.assign({},m.selected)},keys:!0}),U=t.text({parent:V,bottom:0,height:1});U.hide();let K={};const W=()=>{let t=`${_} of '|frame|'`;M.trace&&(t=`${_} of '${M.trace.name}'`),V.setLabel(t),V.data.label=t;const n=[],r=M;K={};let a=0;for(const[t,c]of Object.entries(r.values)){if(e.standard.includes(t)){a++;continue}K[t]=c;const r=l.dddString(o.PlConverter.PlToString(c,e,!0),L.width-t.length-6);if(t.includes(s.METHOD_SEP)){const e=i.UnscrambleFunction(t);0==e[1].length?n.push(`{yellow-fg}[H]{/} {cyan-fg}${u.PlStuffTypeToString(c.type)}{/cyan-fg} ${e[0]}: ${r}`):n.push(`{cyan-fg}${e[0]}{/cyan-fg}.${e[1]}: ${r}`)}else n.push(`{cyan-fg}${u.PlStuffTypeToString(c.type)}{/cyan-fg} ${t}: ${r}`)}a>0?(U.setContent(`... and ${a} standard values`),U.show(),H.height="100%-3"):(U.hide(),H.height="100%-2"),H.setItems(n),H.select(0),g.render()};H.on("select",(function(t,n){Z.content=Y+"\nLoading...",Z.show();const r=Object.values(K)[n],o=Object.keys(K)[n],s=l.shallowJSON(r.value),i=[Y];i.push(`Name: '${o}'`),i.push(`Type: {cyan-fg}${u.PlStuffGetType(r)}{/}`),i.push(`Str(${o}): {green-fg}${c(r,e,!0)}{/}`),i.push(`Debug: {red-fg}${f(r)}{/}`),i.push(`Internals: {yellow-fg}${s}{/}`),Z.content=i.join("\n"),Z.focus(),Z.render()})),W();const J=t.button({parent:w,height:1,left:E.content.length+A.content.length+4,top:0,content:"Eval [E]",shrink:!0,mouse:!0,style:{fg:"green",focus:{fg:"white"}}}),q=t.box({parent:g,tags:!0,top:"25%",left:"25%",width:"50%",height:"75%",border:"line",draggable:!0,padding:{left:1,right:1}});q.key(["escape","x"],(function(){q.hide()})),q.hide(),t.text({parent:q,content:"{bold}Eval{/}{|}('esc' or 'x' to close)",tags:!0,top:0,left:0,height:1,shrink:!0});const z=function(){Q.setContent(""),Q.hide(),Q.show(),q.show(),X.focus(),q.render()};J.on("click",z),g.key(["e"],z);const X=t.textbox({parent:q,inputOnFocus:!0,top:1,left:0,height:3,border:"line",padding:{left:1,right:1}});X.key(["escape"],(()=>q.focus()));const Q=t.box({parent:q,top:4,left:0,border:"line",height:"100%-6",tags:!0,label:"{bold}Output{/}",padding:{left:1,right:1}});X.on("submit",(function(){const t=X.value;X.clearValue();const n=p.NewPlFile("debugger",t),r=new h.default(n),o=new T.PlAstParser(r).parseAll();if(null==o)return Q.setContent("{red-fg}failed to parse input{/}"),Q.hide(),Q.show(),X.focus(),void Q.render();const i=e.program.program.length,a=s.EmitProgram(o,!1);a.program.pop(),a.debug=[],e.addProgram(a);const y=e.pointer;if(e.runProgram(i),e.pointer=y,e.problems.length>0)return Q.setContent("{red-fg}failed to interpret input{/}"),e.problems=[],Q.hide(),Q.show(),X.focus(),void Q.render();const d=e.stack.pop(),P=l.shallowJSON(d.value),S=[];S.push(`Type: {cyan-fg}${u.PlStuffGetType(d)}{/}`),S.push(`Str(input): {green-fg}${c(d,e,!0)}{/}`),S.push(`Debug: {red-fg}${f(d)}{/}`),S.push(`Internals: {yellow-fg}${P}{/}`),Q.content=S.join("\n"),Q.hide(),Q.show(),X.focus(),Q.render()}));const Y="{bold}Detailed View{/}{|}('ESC' or 'x' to close)",Z=t.box({parent:g,top:"25%",left:"25%",width:"50%",shrink:!0,border:"line",draggable:!0,tags:!0,padding:{left:1,right:1}});Z.key(["escape","x"],(function(){Z.hide()})),Z.hide(),L.on("click",(()=>L.focus())),G.on("click",(()=>G.focus())),H.on("click",(()=>H.focus()));const ee=[L,x,V];let te=0;const ne=ee.length-1;ee.forEach((function(e,t){e.on("click",(function(){const e=ee[te];e.setLabel(S(e.data.label)),e.data.label=S(e.data.label),te=t,g.render()}))})),g.key(["tab"],(function(){const e=ee[te];te==ne?te=0:te+=1;const t=ee[te];t.focus(),t.children.length>1&&t.children[1].focus(),t.setLabel(P(t.data.label)),t.data.label=P(t.data.label),e.setLabel(S(e.data.label)),e.data.label=S(e.data.label),g.render()})),ee[0].setLabel(`${d} `+ee[0].data.label),ee[0].data.label=`${d} `+ee[0].data.label,e.pointer+=1;const re=function(t){y=!1,g.destroy(),e.pointer-=1,null!=t&&(e.returnCode=t),n(null)};g.key(["C-c","q"],re),L.focus(),g.render(),g.program.hideCursor()}))}))}},6412:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IACTSync=t.IACTPrepare=void 0;const r=n(6962);t.IACTPrepare=function(){if(!r.isNode)return!1;try{return n(7245),!0}catch(e){return!1}},t.IACTSync=function(e){return n(9907)((function(t){e.then((e=>{t(e)})).catch((e=>{t(e)}))}))()}},5469:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogProblemList=t.LogTrace=t.CreateFrame=t.LogProblemShort=t.LogCallbackProblem=t.LogProblem=t.CreateProblemMessage=t.CreateProblemBody=t.CreateProblemTitle=void 0;const r=n(1717),o=n(1888),l=n(2543),s=n(1624);function i(e,t,n){return s.replaceForAll(s.lineWrap(e,60-n),"\n","\n"+t)}function u(e,t){return t>=0&&t<e.length?s.dddString(e[t],60):null}function a(e,t){const n=[];return null==t?n.push(`[${e}]`):n.push(`[${e}] In "${t.filename}" on line ${t.row+1}`),n}function c(e,t,n,o=l.colors.grey){const s=[],i=t.col-t.length,a=(t.row+2).toString().length,c=n.split("\n"),[f,p,T]=function(e,t){let n=[],r=[];for(let r=0;r<1;++r)n.push(u(e,t-r-1));for(let n=0;n<2;++n)r.push(u(e,t+n+1));return[n,u(e,t),r]}(c,t.row);let h=t.row-1+1;for(const e of f)null!==e&&s.push(o(h.toString().padStart(a)+"| "+e)),++h;s.push(h.toString().padStart(a)+"| "+p),++h,s.push(" ".repeat(a)+o("| ")+" ".repeat(i)+l.colors.red("^".repeat(t.length)+" "+r.HTMessage(e)));for(const e of T)null!==e&&s.push(o(h.toString().padStart(a)+"| "+e)),++h;return s}function f(e,t){const n=[],r=o.PCHint(e);n.push(`${l.colors.yellow("Hint")}: ${i(s.capitalize(r),"      ",6)}`);const u=o.PCFullName(e);return n.push(`${l.colors.cyan(u)}: ${i(s.capitalize(t)," ".repeat(u.length)+"  ",u.length+2)}`),n}function p(e,t){let n=`In frame '${e}'`;return t&&(n+=` on line ${t.row+1}`),n}function T(e){const t=o.default[e];if(null==t)return`[${e}]\nNo entry found for ${e}`;const n=o.PCHint(e),r=o.PCFullName(e);return`[${e}]\nType: ${l.colors.cyan(r)}\nHint: ${l.colors.yellow(s.lineWrap(n,80))}\nTemplate: ${s.lineWrap(t,80)}`}t.CreateProblemTitle=a,t.CreateProblemBody=c,t.CreateProblemMessage=f,t.LogProblem=function(e,t){let n=[];const{code:r,info:o,message:l,here:s}=e;return n.push(...a(r,o)),null!=o&&n.push(...c(s,o,t)),n.push(""),n.push(...f(r,l)),n.join("\n")},t.LogCallbackProblem=function(e){let t=[];const{code:n,info:r,message:o,here:l}=e;return t.push(...a(n,r)),t.push(""),t.push(...f(n,o)),t.join("\n")},t.LogProblemShort=function(e){return`On line ${e.info.row+1}\n${l.colors.cyan(o.PCFullName(e.code))}: ${s.capitalize(e.message)}`},t.CreateFrame=p,t.LogTrace=function(e){let t=[];for(const n of e){if(3==t.length){t.push(`... ${e.length-3} frame(s) omitted`);break}t.push(p(n.name,n.info))}return t.reverse(),t.join("\n")},t.LogProblemList=function(e){const t=Object.keys(o.default),n=[];if(0==e.length)for(const e of t)n.push(T(e));else for(const t of e)n.push(T(t));return n.join("\n\n")}},1717:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewPlProblemAt=t.NewPlProblem=t.HTMessage=void 0;const r=n(1888),o=n(1624),l={before:"before here",here:"here",after:"after here"};function s(e,t){for(let n=0;n<t.length;++n)e=e.replace("%"+n,o.escapeString(t[n]));return e}t.HTMessage=function(e){return l[e]},t.NewPlProblem=function(e,t,...n){return{info:t,message:s(r.default[e],n),code:e,here:"here"}},t.NewPlProblemAt=function(e,t,n="here",...o){return{info:t,message:s(r.default[e],o),code:e,here:n}}},5987:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewPlTraceFrame=void 0,t.NewPlTraceFrame=function(e,t=null){return{name:e,info:t}}},8538:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartDemo=t.StartREPL=t.GetLine=void 0;const r=n(6962),o=n(181),l=n(5469),s=n(2543),i=n(3607),u=n(1176),a=n(2051),c=n(5072),f=n(4098),p=n(4619),T=n(1609),h=n(866),y=n(4978);function d(e){let t="",n=!0,i=1;e:for(;;){let u=n?`${e}> `:`${(""+i).padStart(e.length," ")}| `;i+=1;const c=r.Inout().input(u);if(null===c){if(n)return null;break}let f=t;t+=c;const p=a.NewPlFile(e,t),T=o.TryRunParser(p);t+="\n";let h=n;if(n&&(n=!1),null!=T){for(const e of T)if(e.code.startsWith("CE"))continue e;if(!h&&(r.Inout().print(`${l.LogProblemShort(T[0])}`),"n"!=r.Inout().input(s.colors.magenta(`Undo line ${i-1}? `)+`[${s.colors.green("y")}/n]: `))){i-=1,t=f;continue}}break}return t.slice(0,t.length-1)}t.GetLine=d,t.StartREPL=function(e){if(r.Inout().print(`Welcome to the Deviation interactive console (version ${c.timestamp})`),r.isNode){const e=n(2087);r.Inout().print(`Running on ${e.platform()}-${e.arch()}. Hello ${e.hostname()}!`),r.Inout().print("Press Ctrl+C to quit")}let t=!1;const l=new u.PlStackMachine(Object.assign(Object.assign({},r.Inout()),{input:e=>(t=!0,r.Inout().input(e)),print:e=>{t=!0,r.Inout().print(e),r.Inout().flush()}}),a.NewPlFile("repl",""));for(;;){t=!1;const n=d(e);if(null==n)break;const s=a.NewPlFile(e,n),u=o.RunOnce(l,s);0==t&&null!=u&&r.Inout().print(`${" ".repeat(e.length)}> ${i.PlConverter.PlToString(u,l)}`),l.rearm()}return r.Inout().print("Input Terminated, Goodbye"),r.Inout().flush(),0},t.StartDemo=function(e){r.Inout().print(`Running Deviation in demo mode (version ${c.timestamp})`),r.isNode&&r.Inout().print("Press Ctrl-C to quit");const t=new u.PlStackMachine(Object.assign(Object.assign({},r.Inout()),{input:e=>"",print:e=>{}}),a.NewPlFile("demo",""));for(;;){const n=d(e);if(null==n)break;const o=a.NewPlFile(e,n);r.Inout().print("[Running] Lexing and Parsing...");const l=new f.default(o),s=new p.PlAstParser(l).parseAll();if(null==s){r.Inout().print("[Error] Parser error found, try again?");continue}r.Inout().print("[Display] Printing Parser output"),r.Inout().print(h.ASTProgramToString(s)),r.Inout().print(""),r.Inout().print("[Running] Emitting bytecodes...");const u=T.EmitProgram(s);if(r.Inout().print("[Display] Printing bytecodes"),r.Inout().print(y.PlProgramToString(u)),r.Inout().print(""),r.Inout().print("[Running] Executing Virtual Machine"),u.program.pop(),t.addProgram(u,o.content),null==t.runProgram()){r.Inout().print("[Error] VM error found, try again?"),t.rearm();continue}const c=t.popStack();let P="empty";null!=c&&(P=i.PlConverter.PlToString(c,t)),r.Inout().print("[Display] Printing expression result"),r.Inout().print(`${" ".repeat(e.length)}> ${P}`),t.rearm()}return r.Inout().print("Input Terminated, demo stopped"),r.Inout().flush(),0}},5072:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timestamp=void 0,t.timestamp="2021-09-02T07:23:02.477Z"},8968:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BytecodeToString=t.BytecodeTypeToString=t.NewBytecode=t.PlBytecodeType=void 0;const r=n(8487),o=n(1624);var l;!function(e){e[e.DEFNUM=0]="DEFNUM",e[e.DEFVAR=1]="DEFVAR",e[e.DEFFUN=2]="DEFFUN",e[e.DEFNUL=3]="DEFNUL",e[e.DEFBOL=4]="DEFBOL",e[e.DEFSTR=5]="DEFSTR",e[e.DEFTYP=6]="DEFTYP",e[e.DEFETY=7]="DEFETY",e[e.DEFLST=8]="DEFLST",e[e.DEFDIC=9]="DEFDIC",e[e.JMPIFT=10]="JMPIFT",e[e.JMPIFF=11]="JMPIFF",e[e.JMPICT=12]="JMPICT",e[e.JMPICF=13]="JMPICF",e[e.JMPREL=14]="JMPREL",e[e.DOFDCL=15]="DOFDCL",e[e.DOCALL=16]="DOCALL",e[e.DORETN=17]="DORETN",e[e.DOASGN=18]="DOASGN",e[e.DOCRET=19]="DOCRET",e[e.DOFIND=20]="DOFIND",e[e.DOOINC=21]="DOOINC",e[e.DOODEC=22]="DOODEC",e[e.DONEGT=23]="DONEGT",e[e.DOLNOT=24]="DOLNOT",e[e.DOBRAK=25]="DOBRAK",e[e.DOCONT=26]="DOCONT",e[e.STKPOP=27]="STKPOP",e[e.STKENT=28]="STKENT",e[e.STKEXT=29]="STKEXT"}(l=t.PlBytecodeType||(t.PlBytecodeType={}));const s=r.tsEnumKeys(l);t.NewBytecode=function(e,t=null){return{type:e,value:t}},t.BytecodeTypeToString=function(e){return s[e]},t.BytecodeToString=function(e){return`${s[e.type]}`+(null==e.value?"":` |${o.dddString(o.escapeString(e.value),7)}|`)}},4464:(e,t)=>{"use strict";function n(e,t,n){const r=null==e.attribute?e.constructor.name:e.attribute;return{span:e.getSpanToken(),name:r,endLine:t,length:n}}function r(e,t,n){return e.endLine<=n&&e.endLine-e.length>=t}Object.defineProperty(t,"__esModule",{value:!0}),t.PlDebugProgramWithin=t.PlDebugWithin=t.PlDebugToString=t.NewPlDebugStretch=t.NewPlDebugSingle=t.NewPlDebug=void 0,t.NewPlDebug=n,t.NewPlDebugSingle=function(e){return n(e,0,1)},t.NewPlDebugStretch=function(e,t){return n(e,0,t)},t.PlDebugToString=function(e){return`${e.name}@${e.span.info.row}:${e.span.info.col}`},t.PlDebugWithin=r,t.PlDebugProgramWithin=function(e,t,n){const o=[];for(const l of e)r(l,t,n)&&o.push(l);return o}},1609:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmitStatement=t.EmitProgram=t.MATCH_VALUE=t.EACH_ITER=t.LOOP_INDEX=t.METHOD_SEP=void 0;const r=n(8968),o=n(4538),l=n(4464),s=n(3550),i=n(6962);function u(e,t=!1){let n=new c;for(const t of e)n.addPWD(a(t));const o=n.toProgram();return!t||0!=o.program.length&&o.program[o.program.length-1].type==r.PlBytecodeType.DORETN||o.program.push(h(),r.NewBytecode(r.PlBytecodeType.DORETN)),o}function a(e){return(new c).addPWD(p(e)).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP)).toProgram()}t.METHOD_SEP="@",t.LOOP_INDEX="i@",t.EACH_ITER="iter@",t.MATCH_VALUE="value@",t.EmitProgram=u,t.EmitStatement=a;class c{constructor(){this.emitDebug="debug"==i.Inout().options.mode,this.code=[],this.debugs=[],this.line=0}addPWDNoDebug(e){return this.code.push(...e.program),this.line+=e.program.length,this}addPWD(e,t){return this.code.push(...e.program),this.emitDebug&&(e.debug.forEach((e=>{e.endLine+=this.line})),this.debugs.push(...e.debug)),this.line+=e.program.length,this.emitDebug&&t&&(t.endLine+=this.line,this.debugs.push(t)),this}addPWDStretch(e,t,n=null){return this.addPWD(e,l.NewPlDebugStretch(t,null==n?this.code.length+e.program.length:n))}addBytecode(e,t){return this.code.push(e),this.line+=1,this.emitDebug&&t&&(t.endLine+=this.line,this.debugs.push(t)),this}addBytecodeSingle(e,t){return this.addBytecode(e,l.NewPlDebugSingle(t))}addBytecodeStretch(e,t){return this.addBytecode(e,l.NewPlDebugStretch(t,this.code.length+1))}addEmpty(){return this.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFETY))}addStretch(e,t=null){if(!this.emitDebug)return this;let n=l.NewPlDebugStretch(e,null==t?this.code.length:t);return n.endLine+=this.line,this.debugs.push(n),this}popDebug(){return this.emitDebug?(this.debugs.pop(),this):this}toProgram(){return{program:this.code,debug:this.debugs}}}function f(e,t){let n=0;const o=e.program.length;for(let l=0;l<o;++l){const s=e.program[l];switch(s.type){case r.PlBytecodeType.DOBRAK:null==s.value&&(e.program[l]=r.NewBytecode(r.PlBytecodeType.DOBRAK,`${o+t-l},${n}`));break;case r.PlBytecodeType.DOCONT:null==s.value&&(e.program[l]=r.NewBytecode(r.PlBytecodeType.DOCONT,`${o+t-l-1},${n}`));break;case r.PlBytecodeType.STKENT:n+=1;break;case r.PlBytecodeType.STKEXT:n-=1}}}function p(e){let n=new c;if(e instanceof o.ASTNumber)return n.addBytecode(function(e){return r.NewBytecode(r.PlBytecodeType.DEFNUM,""+e.value)}(e)).toProgram();if(e instanceof o.ASTVariable)return n.addBytecodeSingle(function(e){return r.NewBytecode(r.PlBytecodeType.DEFVAR,e.content)}(e),e).toProgram();if(e instanceof o.ASTNull)return n.addBytecode(h()).toProgram();if(e instanceof o.ASTBoolean)return n.addBytecode(function(e){return r.NewBytecode(r.PlBytecodeType.DEFBOL,""+ +e.value)}(e)).toProgram();if(e instanceof o.ASTString)return n.addBytecode(function(e){return r.NewBytecode(r.PlBytecodeType.DEFSTR,`${e.content}`)}(e)).toProgram();if(e instanceof o.ASTBreak)return n.addBytecodeSingle(r.NewBytecode(r.PlBytecodeType.DOBRAK),e).toProgram();if(e instanceof o.ASTContinue)return n.addBytecodeSingle(r.NewBytecode(r.PlBytecodeType.DOCONT),e).toProgram();if(e instanceof o.ASTList){for(const t of e.values.reverse())n.addPWD(p(t));return n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,""+e.values.length)).addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DEFLST),e).toProgram()}if(e instanceof o.ASTDict){for(let t=e.keys.length-1;t>=0;--t){n.addPWD(p(e.values[t]));const l=e.keys[t];let s;l instanceof o.ASTVariable||l instanceof o.ASTString?s=l.content:l instanceof o.ASTNumber&&(s=l.value),n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFSTR,s))}return n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,""+e.keys.length)).addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DEFDIC),e).toProgram()}if(e instanceof o.ASTType){const t=e.members.length;for(let r=t-1;r>=0;r--)n.addBytecode(T(e.members[r]));return n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,""+t)).addBytecode(T(e.name)).addBytecode(r.NewBytecode(r.PlBytecodeType.DEFTYP)).addEmpty().addBytecode(T(e.name)).addBytecode(r.NewBytecode(r.PlBytecodeType.DOCRET)).toProgram()}if(e instanceof o.ASTCreate)return n.addPWD(p(e.value)),e.pre?n.addPWD(p(e.pre)):n.addEmpty(),n.addBytecode(T(e.variable)),n.addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DOCRET),e),n.toProgram();if(e instanceof o.ASTAssign)return n.addPWD(p(e.value)),e.pre?n.addPWD(p(e.pre)):n.addEmpty(),n.addBytecode(T(e.variable)),n.addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DOASGN),e),n.toProgram();if(e instanceof o.ASTDot)return n.addPWD(p(e.left)).addBytecode(T(e.right)).addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DOFIND),e).toProgram();if(e instanceof o.ASTBinary){if(e.operator.type==s.PlTokenType.AND){let t=p(e.right);const l=p(e.left);return e.left.attribute=o.ASTAttributes.ASTCondition,n.addPWD(l).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPIFF,""+(t.program.length+1))).addStretch(e.left,l.program.length+1).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP)).addPWDStretch(t,e).toProgram()}if(e.operator.type==s.PlTokenType.OR){let t=p(e.right);const l=p(e.left);return e.left.attribute=o.ASTAttributes.ASTCondition,n.addPWD(l).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPIFT,""+(t.program.length+1))).addStretch(e.left,l.program.length+1).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP)).addPWDStretch(t,e).toProgram()}return n.addPWD(p(e.right)).addPWD(p(e.left)).addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,"2")).addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DOFDCL,e.operator.content),e).toProgram()}if(e instanceof o.ASTUnary){let t;switch(n.addPWD(p(e.value)),e.operator.type){case s.PlTokenType.INC:t=r.NewBytecode(r.PlBytecodeType.DOOINC);break;case s.PlTokenType.DEC:t=r.NewBytecode(r.PlBytecodeType.DOODEC);break;case s.PlTokenType.SUB:t=r.NewBytecode(r.PlBytecodeType.DONEGT);break;case s.PlTokenType.NOT:t=r.NewBytecode(r.PlBytecodeType.DOLNOT)}return t&&n.addBytecodeStretch(t,e),n.toProgram()}if(e instanceof o.ASTReturn)return e.content?n.addPWD(p(e.content)):n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUL)),n.addBytecode(r.NewBytecode(r.PlBytecodeType.DORETN)).addStretch(e).toProgram();if(e instanceof o.ASTFunction){const t=y(e.block);e.guards.reverse();for(const t of e.guards)null==t?n.addEmpty():n.addBytecode(T(t)).addStretch(t,1);e.args.reverse();for(const t of e.args)n.addBytecode(T(t));let o=!1;return 0!=t.program.length&&t.program[t.program.length-1].type==r.PlBytecodeType.DORETN||(o=!0),n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,""+e.args.length)).addBytecode(r.NewBytecode(r.PlBytecodeType.DEFFUN,""+(t.program.length+ +(o?2:0)))).addPWD(t),o&&n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUL)).addBytecode(r.NewBytecode(r.PlBytecodeType.DORETN)),n.addEmpty().addBytecode(r.NewBytecode(r.PlBytecodeType.DEFSTR,e.name.content)).addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DOCRET),e).toProgram()}if(e instanceof o.ASTClosure){const t=y(e.block);e.guards.reverse();for(const t of e.guards)null==t?n.addEmpty():n.addBytecode(T(t)).addStretch(t,1);e.args.reverse();for(const t of e.args)n.addBytecode(T(t));let o=!1;return 0!=t.program.length&&t.program[t.program.length-1].type==r.PlBytecodeType.DORETN||(o=!0),n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,""+e.args.length)).addBytecode(r.NewBytecode(r.PlBytecodeType.DEFFUN,""+(t.program.length+ +(o?2:0)))).addPWD(t),o&&n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUL)).addBytecode(r.NewBytecode(r.PlBytecodeType.DORETN)),n.toProgram()}if(e instanceof o.ASTImpl){n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFVAR,e.target.content)).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP)).addStretch(e.target);const o=y(e.block);e.guards.reverse();for(const t of e.guards)null==t?n.addEmpty():n.addBytecode(T(t)).addStretch(t,1);e.args.reverse();for(const t of e.args)n.addBytecode(T(t));let l=!1;0!=o.program.length&&o.program[o.program.length-1].type==r.PlBytecodeType.DORETN||(l=!0),n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,""+e.args.length)).addBytecode(r.NewBytecode(r.PlBytecodeType.DEFFUN,""+(o.program.length+ +(l?2:0)))).addPWD(o),l&&n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUL)).addBytecode(r.NewBytecode(r.PlBytecodeType.DORETN)),n.addEmpty();const s=`${e.target.content}${t.METHOD_SEP}${e.name.content}`;return n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFSTR,s)),n.addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DOCRET),e),n.toProgram()}if(e instanceof o.ASTCall){e.args.reverse();for(const t of e.args)n.addPWD(p(t));return n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUM,""+e.args.length)).addPWD(p(e.target)).addBytecodeStretch(r.NewBytecode(r.PlBytecodeType.DOCALL),e),n.toProgram()}if(e instanceof o.ASTBlock)return n.addPWD(function(e){return(new c).addBytecode(r.NewBytecode(r.PlBytecodeType.STKENT)).addPWD(u(e.statements,!1)).addBytecode(r.NewBytecode(r.PlBytecodeType.STKEXT)).toProgram()}(e)).addEmpty().addStretch(e).toProgram();if(e instanceof o.ASTIf){n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKENT));for(let t=0;t<e.conditions.length;++t){let l=p(e.conditions[t]),s=y(e.blocks[t]);0!=t&&n.addBytecode(r.NewBytecode(r.PlBytecodeType.JMPREL,""+(l.program.length+1+s.program.length)));let i=s.program.length+1;e.conditions.length-t!=1||e.other||(i-=1),e.conditions[t].attribute=o.ASTAttributes.ASTCondition,n.addPWD(l).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPICF,""+i)).addStretch(e.conditions[t],l.program.length+1).addPWD(s)}if(e.other){let t=y(e.other);n.addBytecode(r.NewBytecode(r.PlBytecodeType.JMPREL,""+t.program.length)).addPWD(t)}return n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKEXT)).addEmpty().addStretch(e).toProgram()}if(e instanceof o.ASTFor){let t,l;n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKENT)),e.start&&n.addPWD(p(e.start)).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP));let s=0,i=0;e.condition&&(t=p(e.condition),s=t.program.length+1),e.after&&(l=p(e.after),i=l.program.length+1);let u=y(e.block);return f(u,i),t&&(e.condition.attribute=o.ASTAttributes.ASTCondition,n.addPWD(t).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPICF,""+(u.program.length+i+1))).addStretch(e.condition,t.program.length+1)),n.addPWD(u),l&&n.addPWD(l).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP)),n.addBytecode(r.NewBytecode(r.PlBytecodeType.JMPREL,"-"+(u.program.length+i+s+1))),n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKEXT)).addEmpty().addStretch(e).toProgram()}if(e instanceof o.ASTWhile){n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKENT));let t=p(e.condition),l=y(e.block);return f(l,0),e.condition.attribute=o.ASTAttributes.ASTCondition,n.addPWD(t).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPICF,""+(l.program.length+1))).addStretch(e.condition,t.program.length+1).addPWD(l).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPREL,"-"+(t.program.length+l.program.length+2))),n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKEXT)).addEmpty().addStretch(e).toProgram()}if(e instanceof o.ASTLoop){n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKENT));let l=y(e.block),i=l.program.length;if(e.amount){const l=e.amount.getSpanToken(),u=new o.ASTCreate([],void 0,new o.ASTVariable([],t.LOOP_INDEX),e.amount);n.addPWD(p(u)).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP));const a=p(new o.ASTBinary([],new o.ASTUnary([l],s.NewFakePlToken(s.PlTokenType.DEC,"--"),new o.ASTVariable([],t.LOOP_INDEX)),new o.ASTNumber([],"0"),s.NewFakePlToken(s.PlTokenType.GTE,">=")));e.amount.attribute=o.ASTAttributes.ASTCondition,n.addPWDNoDebug(a).addStretch(e.amount,a.program.length).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPICF,""+(i+1))),i+=a.program.length+1}return f(l,0),n.addPWD(l).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPREL,"-"+(i+1))),n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKEXT)).addEmpty().addStretch(e).toProgram()}if(e instanceof o.ASTMatch){let l=null;if(e.value){l=new o.ASTVariable([],t.MATCH_VALUE);const s=new o.ASTCreate([],void 0,l,e.value);n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKENT)).addPWD(p(s)).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP))}let i=[];for(const t of e.cases){let e=null;for(const n of t){const t=null==l?n:new o.ASTBinary([],l,n,s.NewFakePlToken(s.PlTokenType.EQ,"=="));e=null==e?t:new o.ASTBinary([],e,t,s.NewFakePlToken(s.PlTokenType.OR,"or"))}i.push(e)}const u=p(new o.ASTIf([],i,e.blocks,e.other));return l&&(u.program.shift(),u.debug.forEach((e=>e.endLine-=1))),n.addPWD(u).popDebug().addStretch(e).toProgram()}if(e instanceof o.ASTEach){n.addBytecode(r.NewBytecode(r.PlBytecodeType.STKENT));const l=new o.ASTVariable([],t.EACH_ITER),s=new o.ASTVariable([],t.LOOP_INDEX),i=e.iterator.getSpanToken(),u=new o.ASTDot([],e.iterator,new o.ASTVariable([i],"iter"));u.attribute=o.ASTAttributes.ASTCondition;const a=new o.ASTCreate([],void 0,l,new o.ASTCall([],u,[]));n.addPWD(p(a)).addBytecode(r.NewBytecode(r.PlBytecodeType.STKPOP));const c=new o.ASTVariable([],"1"),T=new o.ASTVariable([],"2"),h=new o.ASTDot([],new o.ASTCreate([],void 0,s,new o.ASTCall([i],new o.ASTDot([],l,new o.ASTVariable([],"next")),[])),T);let d=[];const P=new o.ASTCreate([],void 0,e.value,new o.ASTDot([],new o.ASTDot([],s,c),c));if(d.push(P),e.key){const t=new o.ASTCreate([],void 0,e.key,new o.ASTDot([],new o.ASTDot([],s,c),T));d.push(t)}const S=p(h),m=y(new o.ASTBlock([],d)),g=y(e.block);return f(g,0),n.addPWD(S).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPICF,""+(g.program.length+m.program.length+1))).addPWD(m).addPWD(g).addBytecode(r.NewBytecode(r.PlBytecodeType.JMPREL,"-"+(S.program.length+g.program.length+m.program.length+2))).addBytecode(r.NewBytecode(r.PlBytecodeType.STKEXT)).addEmpty().addStretch(e).toProgram()}return e instanceof o.ASTImport||o.ASTExport,console.log("DEBUG WARNING!"),n.addBytecode(r.NewBytecode(r.PlBytecodeType.DEFNUL)).addBytecode(r.NewBytecode(r.PlBytecodeType.DORETN)).toProgram()}function T(e){return r.NewBytecode(r.PlBytecodeType.DEFSTR,e.content)}function h(e){return r.NewBytecode(r.PlBytecodeType.DEFNUL,null)}function y(e){return(new c).addPWD(u(e.statements,!1)).toProgram()}},4978:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlProgramToString=void 0;const r=n(8968),o=n(4464);t.PlProgramToString=function(e,t=e.debug.length>0){let n=e.program.map((e=>r.BytecodeToString(e)));if(t){let t=Number.MIN_VALUE;n.forEach((e=>{let n=e.length;n>t&&(t=n)})),n=n.map((e=>e+" ".repeat(t-e.length)+" #"));for(const t of e.debug){const{endLine:e,length:r}=t,l=e-r;let s=Number.MIN_VALUE;for(let e=0;e<r;++e){let t=n[l+e].length;t>s&&(s=t)}const i=` + ${o.PlDebugToString(t)} `,u=" |"+" ".repeat(i.length-2);n[l]+=" ".repeat(s-n[l].length)+i;for(let e=1;e<r;++e){let t=n[l+e].length;n[l+e]+=" ".repeat(s-t)+u}}}return n.join("\n")}},1176:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlStackMachine=t.CTOR_NAME=void 0;const r=n(8968),o=n(1717),l=n(5473),s=n(6068),i=n(4214),u=n(3607),a=n(5987),c=n(4441),f={"*":"RE0010",ASTCondition:"RE0014"};t.CTOR_NAME="new",t.PlStackMachine=class{constructor(e,t,n=[]){this.inout=e,this.file=t,this.standard=[],this.returnCode=null,this.stackFrame=new c.PlStackFrame(null,a.NewPlTraceFrame("|file|")),this.closureFrames=[],this.program={program:[],debug:[]},this.rearm(),this.seedFrame(n)}get closureFrame(){return this.closureFrames[this.closureFrames.length-1]}addProgram(e,t){this.program.program.push(...e.program),this.program.debug.push(...e.debug),t&&(this.file.content+=t+"\n")}rearm(){this.problems=[],this.stack=[],this.pointer=this.program.program.length;let e=this.stackFrame;for(;null!=e.outer;)e=e.outer;this.stackFrame=e}saveState(){return{stack:[...this.stack],stackFrame:this.stackFrame,closureFrames:[...this.closureFrames],pointer:this.pointer}}restoreState(e){this.stack=e.stack,this.stackFrame=e.stackFrame,this.closureFrames=e.closureFrames,this.pointer=e.pointer}findFunction(e,t){let n=this.findValue(i.ScrambleImpl(e,t));if(null==n){if(t.type!=l.PlStuffType.Inst)return null;if(n=this.findValue(i.ScrambleType(e,t.type)),null==n)return null}return n.type==l.PlStuffType.NFunc||n.type==l.PlStuffType.Func?n:null}runNFunction(e,t,n=null){const r=e.value,o=r.parameters;let s=!1;for(let e=0;e<o.length;e++){const n=o[e];if(n==l.PlStuffTypeRest){s=!0;break}if(e>=t.length)break;if(n!=l.PlStuffTypeAny&&l.PlStuffTypeToString(t[e].type)!=l.PlStuffTypeToString(n))throw this.newProblem("RE0018",this.pointer,l.PlStuffTypeToString(n),""+(e+1),l.PlStuffTypeToString(t[e].type)),null}if(!s&&t.length!=r.parameters.length)throw this.newProblem("RE0006",this.pointer,""+r.parameters.length,""+t.length),null;const i=this.stackFrame;try{return r.native(...t)}catch(e){if("debugger"==e)return null;const t=null==n?null:n.span.info;if(i==this.stackFrame)this.stackFrame=new c.PlStackFrame(this.stackFrame,a.NewPlTraceFrame(r.name,t));else{let e=this.stackFrame;for(;e.outer!=i;)e=e.outer;e.outer=new c.PlStackFrame(i,a.NewPlTraceFrame(r.name,t))}throw null!=e&&this.newProblem("RE0007",this.pointer,e.message),null}}runFunction(e,t,n){const r=this.pointer;n&&(this.pointer=n);const o=this.getCallDebug(this.pointer);if(e.type==l.PlStuffType.NFunc)try{const n=this.runNFunction(e,t,o);return this.pointer=r,n}catch(e){throw this.pointer=r,null}const s=e.value,i=s.parameters;if(i.length!=t.length)throw console.log(i),this.newProblem("RE0006",this.pointer,""+i.length,""+t.length),this.pointer=r,null;this.closureFrames.push(s.closure),this.stackFrame=new c.PlStackFrame(this.stackFrame,s.closure.trace),null!=o&&this.stackFrame.setTraceInfo(o.span.info);for(let e=0;e<t.length;++e)this.createValue(i[e],t[e]);this.createValue(s.closure.trace.name,e),this.pushStack(null);const u=this.runProgram(s.index+1);if(this.stackFrame=this.stackFrame.outer,this.closureFrames.pop(),this.pointer=r,null==u)throw null;return u}jumpFunction(e,t,n){const r=e.value,o=r.parameters;if(o.length!=t.length)return console.log(o),this.newProblem("RE0006",this.pointer,""+o.length,""+t.length),!1;this.closureFrames.push(r.closure),this.stackFrame=new c.PlStackFrame(this.stackFrame,r.closure.trace),n&&this.stackFrame.setTraceInfo(n.span.info);for(let e=0;e<t.length;++e)this.createValue(o[e],t[e]);return this.createValue(r.closure.trace.name,e),this.pushStack(l.NewPlStuff(l.PlStuffType.Num,this.pointer)),this.pointer=r.index,!0}convertBasicTypes(e,t){if(1!=t.length)return this.newProblem("RE0006",this.pointer,"1",""+t.length),null;const n=t[0],r=this.findFunction(e.type.toLowerCase(),n);return null!=r?this.runFunction(r,[n]):u.PlConverter.PlToPl(n,e,this)}verifyGuards(e,t){const n=e.value;for(let r=0;r<t.length;r++){const o=n.guards[r];if(null!=o)switch(o.type){case l.PlStuffType.NFunc:case l.PlStuffType.Func:{let n=[];const s=o.value.parameters.length;switch(s){case 0:break;case 1:n=[t[r]];break;case 2:n=[e,t[r]];break;case 3:n=[e,t[r],r];break;default:n=[e,t[r],r];for(let e=3;e<s;e++)n.push(l.PlStuffNull)}if(o.type==l.PlStuffType.Func&&(n=this.verifyGuards(o,n),null==n))return null;const i=this.stackFrame;try{t[r]=this.runFunction(o,n)}catch(e){return this.stackFrame=i,null}}}}return t}callSomething(e,n,r){switch(e.type){case l.PlStuffType.Type:{const r=e.value;if(null==r.format){const e=this.convertBasicTypes(r,n);if(null==e)return!1;this.pushStack(e);break}const o={};for(const e of r.format)o[e]=l.PlStuffNull;const s=l.NewPlStuff(l.PlStuffType.Inst,{type:r.type,value:o}),i=this.findFunction(t.CTOR_NAME,s);if(null==i){if(0==n.length){this.pushStack(s);break}if(n.length==r.format.length){for(let e=0;e<r.format.length;e++)s.value.value[r.format[e]]=n[e];this.pushStack(s);break}return this.newProblem("RE0006",this.pointer,`0 or ${r.format.length}`,""+n.length),!1}try{this.runFunction(i,[s,...n])}catch(e){return!1}this.pushStack(s);break}case l.PlStuffType.NFunc:try{this.pushStack(this.runNFunction(e,n,r))}catch(e){return!1}break;case l.PlStuffType.Func:if(e.value,null==(n=this.verifyGuards(e,n)))return!1;if(!this.jumpFunction(e,n,r))return!1}return!0}getCallDebug(e){const{debug:t}=this.program;if(t){for(const n of t)if(n.endLine==e+1)return n;return null}return null}seedFrame(e){for(const[e,t]of Object.entries(s.jsNatives)){const n=Object.assign(Object.assign({},t),{native:u.PlConverter.JsToPl(t.native,this).value.native});this.stackFrame.createValue(e,l.NewPlStuff(l.PlStuffType.NFunc,n)),this.standard.push(e)}for(const[e,t]of Object.entries(s.natives)){const n=Object.assign(Object.assign({},t),{native:t.native.bind(this)});this.stackFrame.createValue(e,l.NewPlStuff(l.PlStuffType.NFunc,n)),this.standard.push(e)}for(const[e,t]of Object.entries(s.jsModules)){const n={};for(const[e,r]of Object.entries(t)){if("object"!=typeof r){n[e]=u.PlConverter.JsToPl(r,this);continue}const t=Object.assign(Object.assign({},r),{native:u.PlConverter.JsToPl(r.native,this).value.native});n[e]=l.NewPlStuff(l.PlStuffType.NFunc,t)}this.stackFrame.createValue(e,l.NewPlStuff(l.PlStuffType.Dict,n)),this.standard.push(e)}for(const[e,t]of Object.entries(s.modules)){const n={};for(const[e,r]of Object.entries(t)){const t=Object.assign(Object.assign({},r),{native:r.native.bind(this)});n[e]=l.NewPlStuff(l.PlStuffType.NFunc,t)}this.stackFrame.createValue(e,l.NewPlStuff(l.PlStuffType.Dict,n)),this.standard.push(e)}this.stackFrame.createValue("process",u.PlConverter.JsToPl({arguments:e,exit:e=>(this.returnCode=+e,null)},this)),this.standard.push("process");for(const e of l.PlStuffTypes){if("Inst"==e)continue;const t=l.NewPlStuff(l.PlStuffType.Type,{type:e,format:null});this.stackFrame.createValue(e,t);const n=i.ScrambleName("new",e);this.stackFrame.createValue(n,l.NewPlStuff(l.PlStuffType.NFunc,{native:(...e)=>{const n=this.convertBasicTypes(t.value,e);if(null==n)throw null;return n},name:"new",self:null,parameters:[l.PlStuffTypeAny],guards:[null]})),this.standard.push(e,n)}}peekStack(e=0){const t=this.stack.length-1-e;return t<0?null:this.stack[t]}pushStack(e){this.stack.push(e)}popStack(){return this.stack.pop()}newProblem(e,t,...n){const{debug:r}=this.program;if(!r)return this.problems.push(o.NewPlProblem("string"==typeof e?e:e["*"],null,...n)),null;let l=null;for(const e of r)t<e.endLine&&t>=e.endLine-e.length&&(null==l||e.length<l.length)&&(l=e);if(null==l)return this.problems.push(o.NewPlProblem("string"==typeof e?e:e["*"],null,...n)),null;if("string"==typeof e)return this.problems.push(o.NewPlProblem(e,l.span.info,...n)),null;if(l.name in e)return this.problems.push(o.NewPlProblem(e[l.name],l.span.info,...n)),null;if("*"in e)return this.problems.push(o.NewPlProblem(e["*"],l.span.info,...n)),null;throw new Error("newProblem did not find a matching code, there is a missing default case")}getProblems(){return this.problems}getTrace(){const e=[];let t=this.stackFrame;for(;null!=t.trace&&e.push(t.trace),null!=(t=t.outer););return e}getFrames(){const e=[];let t=this.stackFrame;for(;e.push(t),null!=(t=t.outer););return e}findValue(e){let t=this.stackFrame.findValue(e);return null!=t||0!=this.closureFrames.length&&(t=this.closureFrame.findValueDeep(e),null!=t)?t:this.stackFrame.findValueDeep(e)}createValue(e,t){return this.stackFrame.createValue(e,t)}setValue(e,t){return null==this.stackFrame.findValue(e)&&0!=this.closureFrames.length&&null!=this.closureFrame.findValueDeep(e)?this.closureFrame.setValue(e,t):this.stackFrame.setValue(e,t)}runProgram(e=this.pointer,t){const{program:n}=this.program;this.pointer=e;try{let e=this.pointer-1;for(;this.pointer<n.length;){if(null!=this.returnCode)return l.NewPlStuff(l.PlStuffType.Num,this.returnCode);if(t&&t(e,this.pointer))return null;const o=n[this.pointer];switch(e=this.pointer,o.type){case r.PlBytecodeType.STKPOP:this.popStack();break;case r.PlBytecodeType.DEFNUM:this.pushStack(l.NewPlStuff(l.PlStuffType.Num,+o.value));break;case r.PlBytecodeType.DEFSTR:this.pushStack(l.NewPlStuff(l.PlStuffType.Str,o.value));break;case r.PlBytecodeType.DEFBOL:"1"==o.value?this.pushStack(l.PlStuffTrue):this.pushStack(l.PlStuffFalse);break;case r.PlBytecodeType.DEFNUL:this.pushStack(l.PlStuffNull);break;case r.PlBytecodeType.DEFTYP:{const e=this.popStack(),t=this.popStack(),n=[];for(let e=0;e<t.value;e++)n.push(this.popStack().value);this.pushStack(l.NewPlStuff(l.PlStuffType.Type,{type:e.value,format:n}));break}case r.PlBytecodeType.DEFETY:this.pushStack(null);break;case r.PlBytecodeType.DEFVAR:{const e=o.value,t=this.findValue(e);if(null!=t){this.pushStack(t);break}return this.newProblem("RE0003",this.pointer,e)}case r.PlBytecodeType.DEFLST:{const e=this.popStack();let t=[];for(let n=0;n<e.value;++n)t.push(u.PlActions.PlCopy(this.popStack()));this.pushStack(l.NewPlStuff(l.PlStuffType.List,t));break}case r.PlBytecodeType.DEFDIC:{let e={};const t=this.popStack();for(let n=0;n<+t.value;++n)e[this.popStack().value]=u.PlActions.PlCopy(this.popStack());this.pushStack(l.NewPlStuff(l.PlStuffType.Dict,e));break}case r.PlBytecodeType.DEFFUN:{const e=this.popStack(),t=[];for(let n=0;n<e.value;++n)t.push(this.popStack().value);const n=[];for(let t=0;t<e.value;++t){const r=this.popStack();if(null==r){n.push(null);continue}const o=r.value;let s=this.findValue(o);if(null==s)return this.newProblem("RE0019",this.pointer-2-e.value-t,o);if(s.type==l.PlStuffType.Type){const e=this.findValue(i.ScrambleName("guard",s.value.type));if(null!=e)s=e;else{const e=s,t=this;s=l.NewPlStuff(l.PlStuffType.NFunc,{native:(n,r,o)=>{if(l.PlStuffGetType(r)!=e.value.type)throw this.newProblem("RE0018",t.pointer,e.value.type,""+(o+1),l.PlStuffGetType(r)),null;return r},name:"guard",parameters:[l.PlStuffTypeAny,l.PlStuffTypeAny,l.PlStuffTypeAny],self:null})}}n.push(s)}const r=+o.value;this.pushStack(l.NewPlStuff(l.PlStuffType.Func,{closure:new c.PlStackFrame(this.stackFrame,a.NewPlTraceFrame("|closure|")),parameters:t,index:this.pointer,self:null,guards:n})),this.pointer+=r;break}case r.PlBytecodeType.DOOINC:{const e=this.popStack();if(e.type==l.PlStuffType.Num){e.value++,this.pushStack(e);break}return this.newProblem("RE0015",this.pointer,l.PlStuffGetType(e))}case r.PlBytecodeType.DOODEC:{const e=this.popStack();if(e.type==l.PlStuffType.Num){e.value--,this.pushStack(e);break}return this.newProblem({"*":"RE0015",ASTCondition:"RE0011"},this.pointer,l.PlStuffGetType(e))}case r.PlBytecodeType.DONEGT:{const e=this.popStack();if(e.type==l.PlStuffType.Num){this.pushStack(l.NewPlStuff(l.PlStuffType.Num,-e.value));break}return this.newProblem("RE0005",this.pointer,l.PlStuffGetType(e))}case r.PlBytecodeType.DOLNOT:{const e=this.popStack();if(e.type==l.PlStuffType.Bool){this.pushStack(1==e.value?l.PlStuffFalse:l.PlStuffTrue);break}return this.newProblem("RE0017",this.pointer,l.PlStuffGetType(e))}case r.PlBytecodeType.DOCRET:case r.PlBytecodeType.DOASGN:{const e=this.popStack(),t=this.popStack(),n=u.PlActions.PlCopy(this.popStack());if(null==t){n.type==l.PlStuffType.Func&&n.value.closure.setTraceName(e.value),o.type==r.PlBytecodeType.DOCRET?this.createValue(e.value,n):this.setValue(e.value,n),this.pushStack(n);break}if(t.type==l.PlStuffType.Dict){if(e.value in t.value){t.value[e.value]=n,this.pushStack(n);break}}else if(t.type==l.PlStuffType.List){let r=Number.parseFloat(""+e.value);if(!Number.isNaN(r)&&(r--,r in t.value)){t.value[r]=n,this.pushStack(n);break}}else if(t.type==l.PlStuffType.Inst&&e.value in t.value.value){t.value.value[e.value]=n,this.pushStack(n);break}return this.newProblem("RE0013",this.pointer,l.PlStuffGetType(t))}case r.PlBytecodeType.DOFDCL:{const e=o.value,t=this.popStack(),n=this.popStack(),r=this.findFunction(e,n);if(null==r)return this.newProblem("RE0004",this.pointer,e,l.PlStuffGetType(n));const s=[n],i=+t.value-1;for(let e=0;e<i;++e)s.push(u.PlActions.PlCopy(this.popStack()));if(!this.callSomething(r,s,this.getCallDebug(this.pointer)))return null;break}case r.PlBytecodeType.DOCALL:{const e=this.popStack();if(e.type!=l.PlStuffType.Func&&e.type!=l.PlStuffType.NFunc&&e.type!=l.PlStuffType.Type)return this.newProblem("RE0008",this.pointer,l.PlStuffGetType(e));const t=this.popStack(),n=[];e.value.self&&n.push(e.value.self);for(let e=0;e<+t.value;++e)n.push(u.PlActions.PlCopy(this.popStack()));if(!this.callSomething(e,n,this.getCallDebug(this.pointer)))return null;break}case r.PlBytecodeType.DOFIND:{const e=this.popStack(),t=this.popStack(),n=e.value;if(t.type==l.PlStuffType.Dict){const e=t.value[n];if(e){this.pushStack(e);break}}else if(t.type==l.PlStuffType.List){let e=Number.parseFloat(""+n);if(!Number.isNaN(e)){e--;const n=t.value[e];if(n){this.pushStack(n);break}}}else if(t.type==l.PlStuffType.Inst){let e=t.value.value[n];if(e){this.pushStack(e);break}}else if(t.type==l.PlStuffType.Type){const e=this.findValue(i.ScrambleName(n,t.value.type));if(null!=e){const n=u.PlActions.PlCopy(e);e.type==l.PlStuffType.NFunc?n.value.self=t:n.value.self=null,this.pushStack(n);break}}const r=this.findValue(i.ScrambleImpl(n,t));if(null!=r){const e=u.PlActions.PlCopy(r);e.value.self=t,this.pushStack(e);break}if(t.type==l.PlStuffType.Inst){const e=this.findValue(i.ScrambleType(n,t.type));if(null!=e){const n=u.PlActions.PlCopy(e);n.value.self=t,this.pushStack(n);break}}return this.newProblem({"*":"RE0012",ASTCondition:"RE0016"},this.pointer,n,l.PlStuffGetType(t))}case r.PlBytecodeType.DORETN:{const e=this.popStack(),t=this.popStack();if(null==t)return e;let n=this.stackFrame;for(;null==n.trace;)n=n.outer;this.stackFrame=n.outer,this.closureFrames.pop(),this.pointer=t.value,this.stack.push(e);break}case r.PlBytecodeType.DOCONT:case r.PlBytecodeType.DOBRAK:{const e=o.value;if(null==e)return this.newProblem("RE0009",this.pointer);const[t,n]=e.split(",");for(let e=0;e<+n;e++)this.stackFrame=this.stackFrame.outer;this.pointer+=+t;break}case r.PlBytecodeType.STKENT:this.stackFrame=new c.PlStackFrame(this.stackFrame);break;case r.PlBytecodeType.STKEXT:this.stackFrame=this.stackFrame.outer;break;case r.PlBytecodeType.JMPREL:this.pointer+=+o.value;break;case r.PlBytecodeType.JMPIFT:{const e=this.peekStack();if(e.type==l.PlStuffType.Bool){1==e.value&&(this.pointer+=+o.value);break}return this.newProblem(f,this.pointer,l.PlStuffGetType(e))}case r.PlBytecodeType.JMPIFF:{const e=this.peekStack();if(e.type==l.PlStuffType.Bool){0==e.value&&(this.pointer+=+o.value);break}return this.newProblem(f,this.pointer,l.PlStuffGetType(e))}case r.PlBytecodeType.JMPICT:{const e=this.popStack();if(e.type==l.PlStuffType.Bool){1==e.value&&(this.pointer+=+o.value);break}return this.newProblem(f,this.pointer,l.PlStuffGetType(e))}case r.PlBytecodeType.JMPICF:{const e=this.popStack();if(e.type==l.PlStuffType.Bool){0==e.value&&(this.pointer+=+o.value);break}return this.newProblem(f,this.pointer,l.PlStuffGetType(e))}default:return this.newProblem("RE0001",this.pointer,r.BytecodeTypeToString(o.type))}++this.pointer}return l.PlStuffNull}catch(e){return this.newProblem("DE0002",this.pointer,""+e)}}}},4441:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlStackFrame=void 0,t.PlStackFrame=class{constructor(e,t=null){this.trace=t,this.outer=e,this.values={}}get isShallow(){return null==this.trace}setTraceName(e){return null==this.trace||(this.trace.name=e),this}setTraceInfo(e){return null==this.trace||(this.trace.info=e),this}findValue(e){let t=this;do{const n=t.values[e];if(n)return n;if(!t.isShallow)return null;t=t.outer}while(null!=t);return null}findValueDeep(e){let t=this;do{const n=t.values[e];if(n)return n;t=t.outer}while(null!=t);return null}setValue(e,t){if(e in this.values)return void(this.values[e]=t);if(null==this.outer||null==this.outer.findValueDeep(e))return void this.createValue(e,t);let n=this.outer;for(;null!=n;){if(e in n.values)return void(n.values[e]=t);n=n.outer}}createValue(e,t){this.values[e]=t}}},3607:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlActions=t.PlConverter=void 0;const r=n(5473),o=n(6734);var l;!function(e){function t(l,s){switch(l.type){case r.PlStuffType.Str:return l.value;case r.PlStuffType.Num:return+l.value;case r.PlStuffType.Type:return u=l,{_version:e.VERSION,type:"Type",value:{type:u.value.type,format:u.value.format}};case r.PlStuffType.Bool:return l.value;case r.PlStuffType.Null:return null;case r.PlStuffType.List:return l.value.map((e=>t(e,s)));case r.PlStuffType.Inst:return function(n,r){const o={};return Object.entries(n.value).forEach((([e,n])=>{o[e]=t(n,r)})),{_version:e.VERSION,type:"Instance",value:{type:n.type,value:o}}}(l.value,s);case r.PlStuffType.Dict:{const e={};return Object.entries(l.value).forEach((([n,r])=>{e[n]=t(r,s)})),e}case r.PlStuffType.NFunc:{const e=(...e)=>t(l.value.native(...e.map((e=>n(e,s)))),s);return e.data=l.value,e}case r.PlStuffType.Func:{const e=s.pointer,r=function(e,t){return(...n)=>{const r=(new Error).stack.split("\n")[2].trim().split(" ")[1];if(null==r||!r.includes("PlStackMachine")){const r=t.saveState();try{return e(...n)}catch(e){t.restoreState(r);const n=t.problems.pop(),l=t.getTrace();return o.ReportProblems(t.file.content,[n],l),null}}return e(...n)}}(((...r)=>t(s.runFunction(l,r.map((e=>n(e,s))),e),s)),s);return r.data=l.value,r}case r.PlStuffType.Raw:return i=l,{_version:e.VERSION,type:"Raw",value:i.value}}var i,u;throw new Error(`PlConvert.PlToJs failed to match object of type ${r.PlStuffTypeToString(l.type)}`)}function n(e,o){switch(typeof e){case"number":return r.NewPlStuff(r.PlStuffType.Num,e);case"string":return r.NewPlStuff(r.PlStuffType.Str,e);case"boolean":return e?r.PlStuffTrue:r.PlStuffFalse;case"function":{let l={};return e.data&&(l=e.data),r.NewPlStuff(r.PlStuffType.NFunc,Object.assign({native:(...r)=>n(e.bind(o)(...r.map((e=>t(e,o)))),o),name:"native",parameters:[r.PlStuffTypeRest],self:null},l))}case"undefined":return r.PlStuffNull;case"object":{if(null==e)return r.PlStuffNull;if(Array.isArray(e))return r.NewPlStuff(r.PlStuffType.List,e.map((e=>n(e,o))));if(function(e){if("_version"in e)switch(e._version){case 1:return"type"in e&&"string"==typeof e.type&&"value"in e&&null!==e.value;default:return!1}return!1}(e))switch(e.type){case"Instance":return function(e,t){const o={};for(const[r,l]of Object.entries(e.value.value))o[r]=n(l,t);return r.NewPlStuff(r.PlStuffType.Inst,{type:e.value.type,value:o})}(e,o);case"Type":return l=e,r.NewPlStuff(r.PlStuffType.Type,{type:l.value.type,format:l.value.format});case"Raw":return function(e){return r.NewPlStuff(r.PlStuffType.Raw,e.value)}(e)}const t={};for(const[r,l]of Object.entries(e))t[r]=n(l,o);return r.NewPlStuff(r.PlStuffType.Dict,t)}}var l;throw new Error("PlConvert.JsToPl failed to match object of type "+typeof e)}function l(e,t,n=!1){switch(e.type){case r.PlStuffType.Bool:return e.value?"true":"false";case r.PlStuffType.Dict:return`dict(${Object.entries(e.value).map((([e,n])=>`${e}: ${l(n,t,!0)}`)).join(", ")})`;case r.PlStuffType.NFunc:case r.PlStuffType.Func:return"[function]";case r.PlStuffType.List:return`list(${e.value.map((e=>l(e,t,!0))).join(", ")})`;case r.PlStuffType.Null:return"null";case r.PlStuffType.Num:return""+e.value;case r.PlStuffType.Str:return n?`"${e.value}"`:e.value;case r.PlStuffType.Type:return e.value.type;case r.PlStuffType.Raw:return"[raw]";case r.PlStuffType.Inst:{let r;return(r=t.findFunction("str",e))?l(t.runFunction(r,[e]),t,n):`${e.value.type}(${Object.entries(e.value.value).map((([e,n])=>`${e}: ${l(n,t,!0)}`)).join(", ")})`}}throw new Error(`PlActions.PlToString failed to match object of type ${r.PlStuffTypeToString(e.type)}`)}e.VERSION=1,e.PlToJs=t,e.JsToPl=n,e.PlToPl=function(e,t,n){if(null!=t.format)return r.PlStuffNull;const o=r.PlStuffGetType(e),s=t.type;if(o==s)return e;switch(r.PlStuffTypeFromString(s)){case r.PlStuffType.Dict:case r.PlStuffType.Inst:case r.PlStuffType.Func:case r.PlStuffType.NFunc:case r.PlStuffType.List:case r.PlStuffType.Null:case r.PlStuffType.Type:return r.PlStuffNull;case r.PlStuffType.Bool:{let t;switch(e.type){case r.PlStuffType.Num:t=0!=e.value;break;case r.PlStuffType.List:case r.PlStuffType.Str:t=0!=e.value.length;break;case r.PlStuffType.Dict:t=0!=Object.keys(e.value).length;break;case r.PlStuffType.NFunc:case r.PlStuffType.Inst:case r.PlStuffType.Func:case r.PlStuffType.Type:t=!0;break;case r.PlStuffType.Null:t=!1}return 1==t?r.PlStuffTrue:r.PlStuffFalse}case r.PlStuffType.Num:{let t=null;switch(e.type){case r.PlStuffType.Bool:t=1==e.value?1:0;break;case r.PlStuffType.Str:{const n=parseFloat(e.value);if(isNaN(n))return r.PlStuffNull;t=n;break}case r.PlStuffType.Null:t=0;break;case r.PlStuffType.Inst:case r.PlStuffType.NFunc:case r.PlStuffType.Dict:case r.PlStuffType.List:case r.PlStuffType.Func:case r.PlStuffType.Type:return r.PlStuffNull}return r.NewPlStuff(r.PlStuffType.Num,t)}case r.PlStuffType.Str:return r.NewPlStuff(r.PlStuffType.Str,l(e,n))}return r.PlStuffNull},e.PlToString=l,e.PlToDebugString=function e(t){switch(t.type){case r.PlStuffType.Bool:return t.value?"true":"false";case r.PlStuffType.Dict:return`Dict(${Object.entries(t.value).map((([t,n])=>`${t}: ${e(n)}`)).join(", ")})`;case r.PlStuffType.Null:return"null";case r.PlStuffType.Inst:return`${t.value.type}(${Object.entries(t.value.value).map((([t,n])=>`${t}: ${e(n)}`)).join(",\n")}\n)`;case r.PlStuffType.List:return`List(${t.value.map((t=>e(t))).join(", ")})`;case r.PlStuffType.Raw:return"[raw]";case r.PlStuffType.Func:{const n=[];t.value.self&&n.push(`self=${e(t.value.self)}`);for(const e of t.value.parameters)n.push(e);return`Func(${n.join(", ")}) -> Any`}case r.PlStuffType.NFunc:{const n=[];t.value.self&&n.push(`self=${e(t.value.self)}`);for(const e of t.value.parameters)"string"!=typeof e?n.push(r.PlStuffTypeToString(e)):n.push(e);return`NFunc(${n.join(", ")}) -> Any`}case r.PlStuffType.Num:return""+t.value;case r.PlStuffType.Str:return`"${t.value}"`;case r.PlStuffType.Type:return`Type(${t.value.type})`}throw new Error("PlToDebugString failed to match an object")}}(t.PlConverter||(t.PlConverter={})),(l=t.PlActions||(t.PlActions={})).PlCopy=function(e){const{type:t,value:n}=e;switch(t){case r.PlStuffType.Num:case r.PlStuffType.Str:case r.PlStuffType.List:case r.PlStuffType.Dict:return r.NewPlStuff(t,n);case r.PlStuffType.Raw:case r.PlStuffType.Inst:case r.PlStuffType.Type:case r.PlStuffType.Bool:case r.PlStuffType.Null:return e;case r.PlStuffType.Func:case r.PlStuffType.NFunc:return r.NewPlStuff(t,Object.assign({},n))}throw new Error(`PlActions.PlCopy failed to match type ${r.PlStuffTypeToString(e.type)}`)},l.PlClone=function e(t){const{type:n,value:o}=t;switch(n){case r.PlStuffType.Num:case r.PlStuffType.Str:return r.NewPlStuff(n,o);case r.PlStuffType.List:return r.NewPlStuff(n,o.map((t=>e(t))));case r.PlStuffType.Func:case r.PlStuffType.NFunc:return r.NewPlStuff(n,Object.assign({},o));case r.PlStuffType.Inst:{const t={};return Object.entries(o.value).forEach((([n,r])=>{t[n]=e(r)})),r.NewPlStuff(n,{type:o.type,value:t})}case r.PlStuffType.Dict:{const t={};return Object.entries(o).forEach((([n,r])=>{t[n]=e(r)})),r.NewPlStuff(n,t)}case r.PlStuffType.Raw:case r.PlStuffType.Type:case r.PlStuffType.Null:case r.PlStuffType.Bool:return t}throw new Error(`PlActions.PlClone failed to match type ${r.PlStuffTypeToString(t.type)}`)}},6596:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenerateForSome=t.GenerateExceptInst=t.GenerateForAll=t.GenerateGuardedTypeFunction=t.GenerateGuardedFunction=t.ExpectedNArguments=t.AssertTypeEqual=t.AssertOperatorsSide=t.AssertType=t.AssertTypeof=void 0;const r=n(4214),o=n(5473),l=n(3810);var s=n(3607).PlConverter.JsToPl;t.AssertTypeof=function(e,t,n,r=1){if(typeof t!=n)throw new Error(l.MakeTypeMessage(e,o.PlStuffTypeFromJsString(n),s(t,null),r))},t.AssertType=function(e,t,n,r=1){if(t.type!=n)throw new Error(l.MakeTypeMessage(e,n,t,r))},t.AssertOperatorsSide=function(e,t){return(n,r)=>{if(typeof n!=typeof r)throw new Error(l.MakeOperatorMessage(e,s(n,null).type,s(r,null).type));return t(n,r)}},t.AssertTypeEqual=function(e,t){return(n,r)=>{if(n.type!=r.type)throw new Error(l.MakeOperatorMessage(e,n.type,r.type));return t(n,r)}},t.ExpectedNArguments=function(e,t,n){if(n!=t)throw new Error(l.MakeArityMessage(e,n,t))},t.GenerateGuardedFunction=function(e,t,n){return{name:e,parameters:t,native:n,self:null}},t.GenerateGuardedTypeFunction=function(e,t,n){return{name:e,parameters:[o.PlStuffTypeAny,...t],self:null,native:n}},t.GenerateForAll=function(e,t){const n={};for(const l of o.PlStuffTypes)n[r.ScrambleName(e,l)]=t;return n},t.GenerateExceptInst=function(e,t){const n={};for(const l of o.PlStuffTypes)"Inst"!=l&&(n[r.ScrambleName(e,l)]=t);return n},t.GenerateForSome=function(e,t,n){const l=t.map((e=>o.PlStuffTypeToString(e))),s={};for(const t of o.PlStuffTypes)l.includes(t)&&(s[r.ScrambleName(e,t)]=n);return s}},6188:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.all=void 0;const r=n(6596),o=n(3607),l=n(5473),s=n(4214),i=n(3810);t.all=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},r.GenerateForAll("copy",r.GenerateGuardedTypeFunction("copy",[],(e=>o.PlActions.PlCopy(e))))),r.GenerateForAll("clone",r.GenerateGuardedTypeFunction("clone",[],(e=>o.PlActions.PlClone(e))))),r.GenerateForSome("isNative",[l.PlStuffType.Func],r.GenerateGuardedTypeFunction("isNative",[],(e=>e.type==l.PlStuffType.NFunc?l.PlStuffTrue:l.PlStuffFalse)))),r.GenerateForAll("is",r.GenerateGuardedTypeFunction("is",[l.PlStuffType.Type],((e,t)=>l.PlStuffGetType(e)==t.value.type?l.PlStuffTrue:l.PlStuffFalse)))),r.GenerateForAll("to",r.GenerateGuardedTypeFunction("to",[l.PlStuffType.Type],(function(e,t){return o.PlConverter.PlToPl(e,t.value,this)})))),r.GenerateExceptInst("bool",r.GenerateGuardedTypeFunction("bool",[],(function(e){return o.PlConverter.PlToPl(e,{format:null,type:"Bool"},this)})))),r.GenerateExceptInst("str",r.GenerateGuardedTypeFunction("str",[],(function(e){return o.PlConverter.PlToPl(e,{format:null,type:"Str"},this)})))),r.GenerateForSome("num",[l.PlStuffType.Bool,l.PlStuffType.Str,l.PlStuffType.Null,l.PlStuffType.Num],r.GenerateGuardedTypeFunction("num",[],(function(e){return o.PlConverter.PlToPl(e,{format:null,type:"Num"},this)})))),r.GenerateForAll("type",r.GenerateGuardedTypeFunction("type",[],(e=>{if(e.type==l.PlStuffType.NFunc)return l.NewPlStuff(l.PlStuffType.Type,{type:"Func",format:null});if(e.type==l.PlStuffType.Inst){const t=Object.keys(e.value);return l.NewPlStuff(l.PlStuffType.Type,{type:l.PlStuffGetType(e),format:t})}return l.NewPlStuff(l.PlStuffType.Type,{type:l.PlStuffGetType(e),format:null})})))),r.GenerateForAll("in",r.GenerateGuardedTypeFunction("in",[l.PlStuffTypeAny],(function(e,t){const n=this.findValue(s.ScrambleType("have",t.type));if(n.type==l.PlStuffType.NFunc)return n.value.native(t,e);if(n.type==l.PlStuffType.Func)return this.runFunction(n,[t,e]);throw new Error(i.MakeNoTypeFunctionMessage("in","have",t))})))),r.GenerateForAll("from",r.GenerateGuardedTypeFunction("from",[l.PlStuffTypeAny],(function(e,t){const n=this.findValue(s.ScrambleType("get",t.type));if(n.type==l.PlStuffType.NFunc)return n.value.native(t,e);if(n.type==l.PlStuffType.Func)return this.runFunction(n,[t,e]);throw new Error(i.MakeNoTypeFunctionMessage("from","get",t))}))))},7744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsDict=t.dict=void 0;const r=n(4214),o=n(5473),l=n(6596),s=n(3607),i=n(3810);var u=s.PlConverter.PlToString;t.dict={[r.ScrambleType("get",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("get",[o.PlStuffTypeAny],(function(e,t){const n=u(t,this);if(n in e.value)return e.value[n];throw new Error(i.MakeNotFoundMessage("get",o.PlStuffType.Dict,n))})),[r.ScrambleType("set",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("set",[o.PlStuffTypeAny,o.PlStuffTypeAny],(function(e,t,n){const r=u(t,this);return e.value[r]=n,n})),[r.ScrambleType("delete",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("delete",[o.PlStuffTypeAny],(function(e,t){const n=u(t,this);if(n in e.value)return delete e.value[n],e;throw new Error(i.MakeNotFoundMessage("delete",o.PlStuffType.Dict,n))})),[r.ScrambleType("size",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("size",[],(function(e){return o.NewPlStuff(o.PlStuffType.Num,Object.keys(e.value).length)})),[r.ScrambleType("have",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("have",[o.PlStuffTypeAny],(function(e,t){for(const n of Object.keys(e.value))if(n==u(t,this))return o.PlStuffTrue;return o.PlStuffFalse})),[r.ScrambleType("iter",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("iter",[],(function(e){const t=Object.keys(e.value);let n=0;return o.NewPlStuff(o.PlStuffType.Dict,{next:o.NewPlStuff(o.PlStuffType.NFunc,{parameters:[],self:null,name:"iter",native:()=>{if(n>=t.length)return o.NewPlStuff(o.PlStuffType.List,[o.PlStuffNull,o.PlStuffFalse]);const r=t[n++];return o.NewPlStuff(o.PlStuffType.List,[o.NewPlStuff(o.PlStuffType.List,[e.value[r],o.NewPlStuff(o.PlStuffType.Str,r)]),o.PlStuffTrue])}})})}))},t.jsDict={[r.ScrambleType("iter",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("iter",[],(function(e){const t=Object.keys(e);let n=0;return{next:()=>{if(n>=t.length)return[null,!1];const r=t[n++];return[[e[r],r],!0]}}})),[r.ScrambleType("keys",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("keys",[],(function(e){return Object.keys(e)})),[r.ScrambleType("values",o.PlStuffType.Dict)]:l.GenerateGuardedTypeFunction("values",[],(function(e){return Object.values(e)}))}},7381:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.func=void 0;const r=n(4214),o=n(5473),l=n(6596),s=n(3607);t.func={[r.ScrambleType("call",o.PlStuffType.Func)]:l.GenerateGuardedTypeFunction("call",[o.PlStuffType.List],(function(e,t){try{return this.runFunction(e,t.value)}catch(e){throw null}})),[r.ScrambleType("bind",o.PlStuffType.Func)]:l.GenerateGuardedTypeFunction("bind",[o.PlStuffTypeAny],(function(e,t){const n=s.PlActions.PlCopy(e);return n.value.self=t,n.value.name+=".bind",n})),[r.ScrambleType("arity",o.PlStuffType.Func)]:l.GenerateGuardedTypeFunction("arity",[],(function(e){return o.NewPlStuff(o.PlStuffType.Num,e.value.parameters.length)})),[r.ScrambleType("name",o.PlStuffType.Func)]:l.GenerateGuardedTypeFunction("name",[],(e=>e.type==o.PlStuffType.Func?o.NewPlStuff(o.PlStuffType.Str,e.value.closure.trace.name):o.NewPlStuff(o.PlStuffType.Str,e.value.name))),[r.ScrambleType("params",o.PlStuffType.Func)]:l.GenerateGuardedTypeFunction("params",[],(function(e){return e.type==o.PlStuffType.Func?o.NewPlStuff(o.PlStuffType.List,e.value.parameters.map((e=>o.NewPlStuff(o.PlStuffType.Str,e)))):e.type==o.PlStuffType.NFunc?o.NewPlStuff(o.PlStuffType.List,e.value.parameters.map((e=>"string"==typeof e?o.NewPlStuff(o.PlStuffType.Str,e):o.NewPlStuff(o.PlStuffType.Str,o.PlStuffTypeToString(e))))):void 0}))}},600:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.list=t.jsList=void 0;const r=n(4214),o=n(5473),l=n(6596),s=n(6093),i=n(3810);var u=n(3607).PlConverter.PlToString;t.jsList={[r.ScrambleType("size",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("size",[],(function(e){return e.length}))},t.list={[r.ScrambleType("iter",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("iter",[],(function(e){let t=0;return o.NewPlStuff(o.PlStuffType.Dict,{next:o.NewPlStuff(o.PlStuffType.NFunc,{parameters:[],self:null,name:"iter",native:()=>t>=e.value.length?o.NewPlStuff(o.PlStuffType.List,[o.PlStuffNull,o.PlStuffFalse]):o.NewPlStuff(o.PlStuffType.List,[o.NewPlStuff(o.PlStuffType.List,[e.value[t++],o.NewPlStuff(o.PlStuffType.Num,t)]),o.PlStuffTrue])})})})),[r.ScrambleType("get",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("get",[o.PlStuffType.Num],(function(e,t){if(t.type!=o.PlStuffType.List&&t.type!=o.PlStuffType.Num)throw new Error("'get' requires a number or a list as argument");const n=e.value,r=t.value-1;if(r<0||r>=n.length)throw new Error(i.MakeOutOfRangeMessage("get",o.PlStuffType.List,n.length,t.value));return n[r]})),[r.ScrambleType("add",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("add",[o.PlStuffTypeAny],(function(e,t){return e.value.push(t),o.NewPlStuff(o.PlStuffType.Num,e.value.length)})),[r.ScrambleType("insert",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("insert",[o.PlStuffType.Num,o.PlStuffTypeAny],(function(e,t,n){if(t.value==e.value.length+1)return e.value.push(n),e;const r=t.value-1;if(r<0||r>=e.value.length)throw new Error(i.MakeOutOfRangeMessage("insert",o.PlStuffType.List,e.value.length,t.value));return e.value.splice(r,0,n),e})),[r.ScrambleType("pop",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("pop",[],(function(e){return e.value.pop()})),[r.ScrambleType("shift",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("shift",[],(function(e){return e.value.shift()})),[r.ScrambleType("set",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("set",[o.PlStuffType.Num,o.PlStuffTypeAny],(function(e,t,n){const r=t.value-1,l=e.value;if(r<0||r>=l.length)throw new Error(i.MakeOutOfRangeMessage("set",o.PlStuffType.List,l.length,t.value));return l[r]=n,n})),[r.ScrambleType("have",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("have",[o.PlStuffTypeAny],(function(e,t){for(const n of e.value)if(s.equals(n,t))return o.PlStuffTrue;return o.PlStuffFalse})),[r.ScrambleType("index",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("index",[o.PlStuffTypeAny],(function(e,t){for(let n=0;n<e.value.length;n++)if(s.equals(e.value[n],t))return o.NewPlStuff(o.PlStuffType.Num,n+1);return o.NewPlStuff(o.PlStuffType.Num,0)})),[r.ScrambleType("shuffle",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("shuffle",[],(function(e){return e.value=function(e){let t,n,r=e.length;for(;0!==r;)n=Math.floor(Math.random()*r),r-=1,t=e[r],e[r]=e[n],e[n]=t;return e}(e.value),e})),[r.ScrambleType("remove",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("remove",[o.PlStuffType.Num],(function(e,t){const n=e.value,r=t.value-1;if(r<0||r>=n.length)throw new Error(i.MakeOutOfRangeMessage("remove",o.PlStuffType.List,n.length,t.value));const[l]=n.splice(r,1);return l})),[r.ScrambleType("join",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("join",[o.PlStuffType.Str],(function(e,t){const n=e.value.map((e=>u(e,this)));return o.NewPlStuff(o.PlStuffType.Str,n.join(t.value))})),[r.ScrambleType("random",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("random",[],(function(e){const t=e.value.length;return e.value[Math.floor(Math.random()*(t-0)+0)]})),[r.ScrambleType("reverse",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("reverse",[],(function(e){const t=[...e.value];return t.reverse(),o.NewPlStuff(o.PlStuffType.List,t)})),[r.ScrambleType("sort",o.PlStuffType.List)]:l.GenerateGuardedTypeFunction("sort",[],(function(e){return e.value.sort(((e,t)=>{const n=this.findFunction(">",e);if(null==n)throw new Error(i.MakeNoTypeFunctionMessage("sort",">",e));const r=this.findFunction("==",e);if(null==r)throw new Error(i.MakeNoTypeFunctionMessage("sort","==",e));let o=this.runFunction(n,[e,t]);return 1==o.value?1:(o=this.runFunction(r,[e,t]),1==o.value?0:-1)})),e}))}},3327:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsNum=void 0;const r=n(4214),o=n(5473),l=n(6596);t.jsNum={[r.ScrambleType("abs",o.PlStuffType.Num)]:l.GenerateGuardedTypeFunction("abs",[],(function(e){return e<0?-e:e})),[r.ScrambleType("floor",o.PlStuffType.Num)]:l.GenerateGuardedTypeFunction("floor",[],(function(e){return Math.floor(e)})),[r.ScrambleType("ceil",o.PlStuffType.Num)]:l.GenerateGuardedTypeFunction("ceil",[],(function(e){return Math.ceil(e)})),[r.ScrambleType("int",o.PlStuffType.Num)]:l.GenerateGuardedTypeFunction("int",[o.PlStuffType.Num],(function(e,t){return e-Math.floor(e)>t?Math.ceil(e):Math.floor(e)})),[r.ScrambleType("round",o.PlStuffType.Num)]:l.GenerateGuardedTypeFunction("round",[o.PlStuffType.Num],(function(e,t){return Number.parseFloat(e).toPrecision(t)})),[r.ScrambleType("pow",o.PlStuffType.Num)]:l.GenerateGuardedTypeFunction("pow",[o.PlStuffType.Num],(function(e,t){return Math.pow(e,t)}))}},1654:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.str=t.jsStr=void 0;const r=n(4214),o=n(5473),l=n(6596),s=n(3810),i=n(1624);t.jsStr={[r.ScrambleType("size",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("size",[],(function(e){return e.length})),[r.ScrambleType("have",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("size",[o.PlStuffType.Str],(function(e,t){return-1!=e.indexOf(t)})),[r.ScrambleType("get",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("get",[o.PlStuffType.Num],(function(e,t){if(--t<0||t>=e.length)throw new Error(s.MakeOutOfRangeMessage("get",o.PlStuffType.Str,e.length,t+1));return e[t]})),[r.ScrambleType("replace",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("replace",[o.PlStuffType.Str,o.PlStuffType.Str],(function(e,t,n){return e.split(t).join(n)})),[r.ScrambleType("insert",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("insert",[o.PlStuffType.Num,o.PlStuffType.Str],(function(e,t,n){if(t==e.length+1)return e+n;if(--t<0||t>=e.length)throw new Error(s.MakeOutOfRangeMessage("insert",o.PlStuffType.Str,e.length,t+1));return e.substring(0,t)+n+e.substring(t)})),[r.ScrambleType("find",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("find",[o.PlStuffType.Str],(function(e,t){const n=e.indexOf(t);return-1==n?null:n+1})),[r.ScrambleType("iter",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("iter",[],(function(e){let t=0;return{next:()=>t>=e.length?[null,!1]:[[e[t++],t],!0]}})),[r.ScrambleType("upper",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("upper",[],(function(e){return e.toUpperCase()})),[r.ScrambleType("lower",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("lower",[],(function(e){return e.toLowerCase()})),[r.ScrambleType("capitalize",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("capitalize",[],(function(e){return i.capitalize(e)})),[r.ScrambleType("reverse",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("reverse",[],(function(e){return e.split("").reverse().join("")})),[r.ScrambleType("startsWith",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("startsWith",[o.PlStuffType.Str],(function(e,t){return e.startsWith(t)})),[r.ScrambleType("endsWith",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("ensdWith",[o.PlStuffType.Str],(function(e,t){return e.endsWith(t)}))},t.str={[r.ScrambleType("split",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("split",[o.PlStuffType.Str],(function(e,t){const n=e.value.split(t.value).map((e=>o.NewPlStuff(o.PlStuffType.Str,e)));return o.NewPlStuff(o.PlStuffType.List,n)})),[r.ScrambleType("remove",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("remove",[o.PlStuffType.Num],((e,t)=>{const n=e.value,r=t.value-1;if(r<0||r>=n.length)throw new Error(s.MakeOutOfRangeMessage("remove",o.PlStuffType.Str,n.length,t.value));const l=n.substring(0,r)+n.substring(r+1);return o.NewPlStuff(o.PlStuffType.Str,l)})),[r.ScrambleType("substring",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("substring",[o.PlStuffType.Num,o.PlStuffType.Num],((e,t,n)=>o.NewPlStuff(o.PlStuffType.Str,e.value.substring(t.value-1,n.value))))}},6068:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modules=t.jsModules=t.natives=t.jsNatives=void 0;const r=n(6093),o=n(600),l=n(6188),s=n(1654),i=n(7744),u=n(1652),a=n(4881),c=n(3327),f=n(160),p=n(2481),T=n(9256),h=n(7381),y=n(6052),d=n(6962);t.jsNatives=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},r.jsOperators),i.jsDict),o.jsList),s.jsStr),c.jsNum),u.jsSpecial),t.natives=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},r.operators),s.str),o.list),i.dict),h.func),l.all),u.special),t.jsModules={maths:a.maths,time:f.time,random:p.random},t.modules={debug:T.debug},d.isNode&&(t.jsModules.system=y.system)},3810:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MakeNoTypeFunctionMessage=t.MakeNotFoundMessage=t.MakeOutOfRangeMessage=t.MakeOperatorMessage=t.MakeArityMessage=t.MakeTypeMessage=void 0;const r=n(5473);t.MakeTypeMessage=function(e,t,n,o){return`'${e}' requires the ${o}th argument to be of type ${r.PlStuffTypeToString(t)} - got ${r.PlStuffTypeToString(n.type)} instead`},t.MakeArityMessage=function(e,t,n){return`'${e}' received an incorrect amount of arguments - it needed ${t} but got ${n}`},t.MakeOperatorMessage=function(e,t,n){return`the operator '${e}' cannot operate on different types on the left and the right - left is ${r.PlStuffTypeToString(t)}, right is ${r.PlStuffTypeToString(n)}`},t.MakeOutOfRangeMessage=function(e,t,n,o){return`'${e}' accessed an element out of range on a ${r.PlStuffTypeToString(t)}: expected ${0==n?"0":"1"}-${n}, got ${o+1}`},t.MakeNotFoundMessage=function(e,t,n){return`'${e}' cannot find the key '${n}' on a ${r.PlStuffTypeToString(t)}`},t.MakeNoTypeFunctionMessage=function(e,t,n){return`'${e}' need the method '${t}' on ${r.PlStuffTypeToString(n.type)}, but none was found`}},9256:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debug=void 0;const r=n(6596),o=n(3607),l=n(4978),s=n(6412),i=n(3836),u=n(6962),a=n(5473);var c=o.PlConverter.PlToDebugString;t.debug={stack:r.GenerateGuardedFunction("stack",[],(function(){return a.NewPlStuff(a.PlStuffType.List,[...this.stack])})),closure:r.GenerateGuardedFunction("closure",[],(function(){return a.NewPlStuff(a.PlStuffType.Dict,Object.assign({},this.closureFrame.values))})),locals:r.GenerateGuardedFunction("locals",[],(function(){return a.NewPlStuff(a.PlStuffType.Dict,Object.assign({},this.stackFrame.values))})),globals:r.GenerateGuardedFunction("globals",[],(function(){let e={},t=this.stackFrame;do{const n={};for(const[e,r]of Object.entries(t.values))n[e]=r;e=Object.assign(Object.assign({},e),n)}while(null!=(t=t.outer));return a.NewPlStuff(a.PlStuffType.Dict,e)})),program:r.GenerateGuardedFunction("program",[],(function(){return a.NewPlStuff(a.PlStuffType.List,l.PlProgramToString(this.program,!1).split("\n").map((e=>a.NewPlStuff(a.PlStuffType.Str,e))))})),pointer:r.GenerateGuardedFunction("pointer",[],(function(){return a.NewPlStuff(a.PlStuffType.Num,this.pointer)})),format:r.GenerateGuardedFunction("format",[a.PlStuffTypeAny],(function(e){return a.NewPlStuff(a.PlStuffType.Str,c(e))}))},u.isNode&&(t.debug.debugger=r.GenerateGuardedFunction("debugger",[],(function(){if("release"==this.inout.options.mode||"repl"==this.inout.options.run)return null;throw s.IACTSync(i.IACTDebugger(this)),"debugger"})))},4881:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maths=void 0;const r=n(6596),o=n(5473);t.maths=function(e,t){const n={};for(const[t,l]of Object.entries({sin:"sin",cos:"cos",tan:"tan",log2:"log2",ln:"log",exp:"exp",pi:"PI",e:"E",sqrt:"sqrt"}))"function"==typeof e[l]?n[t]=r.GenerateGuardedFunction(t,[o.PlStuffType.Num],e[l]):n[t]=e[l];return n}(Math)},2481:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.random=void 0;const r=n(6596),o=n(5473);function l(e,t){return null!=e&&r.AssertTypeof("number",e,"number",1),null!=t&&r.AssertTypeof("number",t,"number",2),null==e&&null==t?(e=1,t=100):null==t?(t=e,e=1):null==e&&(e=1),Math.floor(Math.random()*(t-e+1)+e)}t.random={number:r.GenerateGuardedFunction("number",[o.PlStuffTypeRest],l),list:r.GenerateGuardedFunction("list",[o.PlStuffType.Num,o.PlStuffType.Num,o.PlStuffType.Num],(function(e,t,n){let r=[];for(let o=0;o<n;o++)r.push(l(e,t));return r}))}},6052:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.system=void 0;const r=n(6596),o=n(5473),l=n(6962);t.system={read:r.GenerateGuardedFunction("read",[o.PlStuffType.Str],(e=>{const t=n(5747),r=n(5622);try{return{text:t.readFileSync(r.join(l.Inout().paths.rootPath,e)).toString(),ok:!0}}catch(e){return{text:e.toString(),ok:!1}}})),write:r.GenerateGuardedFunction("read",[o.PlStuffType.Str,o.PlStuffType.Str],((e,t)=>{const r=n(5747),o=n(5622);try{return r.writeFileSync(o.join(l.Inout().paths.rootPath,e),t),{text:t,ok:!0}}catch(e){return{text:e.toString(),ok:!1}}}))}},160:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.time=void 0;const r=n(6596),o=n(5473);t.time={now:r.GenerateGuardedFunction("now",[],(()=>(new Date).getTime())),measure:r.GenerateGuardedFunction("measure",[o.PlStuffType.Func],(e=>{const t=(new Date).getTime();return e(),(new Date).getTime()-t})),benchmark:r.GenerateGuardedFunction("benchmark",[o.PlStuffType.Num,o.PlStuffType.Func],((e,t)=>{const n=[];for(let r=0;r<e;r++){const e=(new Date).getTime();t(),n.push((new Date).getTime()-e)}return n}))}},6093:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.operators=t.jsOperators=t.equals=void 0;const r=n(4214),o=n(5473),l=n(6596);function s(e,t){if(e.type!=t.type)return!1;let n=!1;switch(e.type){case o.PlStuffType.Num:case o.PlStuffType.Bool:case o.PlStuffType.Str:n=e.value===t.value;break;case o.PlStuffType.Type:n=e.value.type==t.value.type;break;case o.PlStuffType.Null:n=!0;break;case o.PlStuffType.List:case o.PlStuffType.Dict:case o.PlStuffType.NFunc:case o.PlStuffType.Func:n=!1}return n}function i(e,t){return e.value>t.value}function u(e,t,n){return l.GenerateGuardedTypeFunction(e,[t],n)}function a(e){return(...t)=>1==e(...t)?o.PlStuffTrue:o.PlStuffFalse}function c(e,t=null,n=null){let s,i,c,f;t&&(s=l.GenerateGuardedTypeFunction("==",[o.PlStuffTypeAny],a(t)),i=l.GenerateGuardedTypeFunction("!=",[o.PlStuffTypeAny],a(((e,n)=>!t(e,n))))),n&&(c=u(">",e,a(n)),f=u("<=",e,a(((e,t)=>!n(e,t)))));let p={};return s&&(p=Object.assign(Object.assign({},p),{[r.ScrambleType("==",e)]:s,[r.ScrambleType("/=",e)]:i})),c&&(p=Object.assign(Object.assign({},p),{[r.ScrambleType(">",e)]:c,[r.ScrambleType("<=",e)]:f})),s&&c&&(p=Object.assign(Object.assign({},p),{[r.ScrambleType("<",e)]:u("<",e,a(((e,r)=>!t(e,r)&&!n(e,r)))),[r.ScrambleType(">=",e)]:u("<",e,a(((e,r)=>t(e,r)||n(e,r))))})),p}t.equals=s,t.jsOperators={[r.ScrambleType("+",o.PlStuffType.Num)]:u("+",o.PlStuffType.Num,((e,t)=>e+t)),[r.ScrambleType("-",o.PlStuffType.Num)]:u("-",o.PlStuffType.Num,((e,t)=>e-t)),[r.ScrambleType("*",o.PlStuffType.Num)]:u("*",o.PlStuffType.Num,((e,t)=>e*t)),[r.ScrambleType("/",o.PlStuffType.Num)]:u("/",o.PlStuffType.Num,((e,t)=>e/t)),[r.ScrambleType("mod",o.PlStuffType.Num)]:u("mod",o.PlStuffType.Num,((e,t)=>e%t)),[r.ScrambleType("+",o.PlStuffType.Str)]:u("+",o.PlStuffType.Str,((e,t)=>e+t)),[r.ScrambleType("*",o.PlStuffType.Str)]:l.GenerateGuardedTypeFunction("*",[o.PlStuffType.Num],((e,t)=>e.repeat(t)))},t.operators=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c(o.PlStuffType.Num,s,i)),c(o.PlStuffType.Str,s,i)),c(o.PlStuffType.Bool,s)),c(o.PlStuffType.Null,s)),c(o.PlStuffType.Type,s)),c(o.PlStuffType.Func,s)),c(o.PlStuffType.List,s)),c(o.PlStuffType.Dict,s)),c(o.PlStuffType.Inst,s))},1652:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.special=t.jsSpecial=void 0;const r=n(3607),o=n(5473),l=n(6596),s=n(3810),i=n(6962);var u=r.PlConverter.PlToString,a=r.PlConverter.VERSION;function c(e){return{method:"method"in e?e.method:"GET",headers:"headers"in e?e.headers:{},body:"body"in e?e.body:null}}if(t.jsSpecial={range:l.GenerateGuardedFunction("range",[o.PlStuffTypeRest],(function(e,t,n){if(null!=e&&l.AssertTypeof("range",e,"number",1),null!=t&&l.AssertTypeof("range",t,"number",2),null!=n&&l.AssertTypeof("range",n,"number",3),arguments.length>3)throw new Error("'range' can only take a maximum of three arguments - start, end, step");2==arguments.length&&(n=1),1==arguments.length&&(t=e,e=n=1);let r=!0;n<0&&(r=!1);let o=e;return{iter:()=>({next:()=>{if(r?o>t:o<t)return[[null,null],!1];const e=[[o,o],!0];return o+=n,e}})}})),try:l.GenerateGuardedFunction("try",[o.PlStuffType.Func,o.PlStuffType.Func],(function(e,t){const n=this.saveState();try{return e()}catch(e){return this.restoreState(n),t(this.problems.pop())}}))},t.special={eval:l.GenerateGuardedFunction("eval",[o.PlStuffTypeAny],(function(e){let t=null;if(t=e.type!=o.PlStuffType.Dict||!("iter"in e.value)||e.value.iter.type!=o.PlStuffType.Func&&e.value.iter.type!=o.PlStuffType.NFunc?this.findFunction("iter",e):e.value.iter,null==t)throw new Error(s.MakeNoTypeFunctionMessage("eval","iter",e));const n=this.runFunction(t,[e]).value.next;let r,l=[];for(;1==(r=this.runFunction(n,[])).value[1].value;)l.push(r.value[0].value[0]);return o.NewPlStuff(o.PlStuffType.List,l)})),ask:l.GenerateGuardedFunction("ask",[o.PlStuffTypeRest],(function(...e){const t=this.inout.input(e.map((e=>u(e,this))).join("\n"));return null==t?o.PlStuffNull:o.NewPlStuff(o.PlStuffType.Str,t)})),javascript:l.GenerateGuardedFunction("javascript",[o.PlStuffType.Str],(function(e){const t=function(e){const t=this.findValue(e);return null==t?null:r.PlConverter.PlToJs(t,this)}.bind(this),n=function(e,t){return this.createValue(e,r.PlConverter.JsToPl(t,this)),null}.bind(this);try{this.inout.execute(e.value,{de:{import:t,export:n}})}catch(e){if(null==e)throw null;throw new Error(`[Javascript ${e.name}] ${e.message}`)}})),panic:l.GenerateGuardedFunction("panic",[o.PlStuffTypeRest],(function(...e){throw new Error(e.map((e=>u(e,this))).join(" "))})),say:l.GenerateGuardedFunction("say",[o.PlStuffTypeRest],(function(...e){if(0==e.length)this.inout.print("\n");else{const t=e.map((e=>u(e,this))).join(" ");this.inout.print(t)}return o.PlStuffNull})),log:l.GenerateGuardedFunction("log",[o.PlStuffTypeRest],(function(...e){if(0==e.length)console.log("\n");else{const t=e.map((e=>u(e,this))).join(" ");console.log(t)}return o.PlStuffNull}))},i.isNode){const e=n(9907),r=n(6786),s=e(function(e){return function(t,n,r){let o;e(t,n).then((e=>(o=e,e.text()))).then((e=>{r(null,{text:e,ok:o.ok,status:o.status})})).catch((e=>{r(null,{text:e.message,ok:!1,status:e.status?e.status:"404"})}))}}(r));t.jsSpecial.fetch=l.GenerateGuardedFunction("fetch",[o.PlStuffType.Str,o.PlStuffType.Dict],(function(e,t){const n=c(t);return s(e,n)}));const i=n(5622),u=n(5747),a=n(3129);t.jsSpecial.$=l.GenerateGuardedFunction("$",[o.PlStuffType.Str,o.PlStuffType.Str],(function(e,t){const n=i.join(this.inout.paths.rootPath,t);if(!u.existsSync(n))return{text:`the target path '${n}' does not exist`,ok:!1};try{return a.execSync(e,{stdio:"inherit",cwd:n}),{text:"",ok:!0}}catch(e){return{text:e.toString(),ok:!1}}})),t.jsSpecial.exec=l.GenerateGuardedFunction("exec",[o.PlStuffType.Str,o.PlStuffType.Dict],(function(e,t){const n=i.join(this.inout.paths.rootPath,t);if(!u.existsSync(n))return{text:`the target path '${n}' does not exist`,ok:!1};try{return{text:a.execSync(e,{stdio:[0,"pipe","pipe"],cwd:n}).toString(),ok:!0}}catch(e){return{text:e.toString(),ok:!1}}})),t.jsSpecial.require=l.GenerateGuardedFunction("require",[o.PlStuffType.Str],(function(e){try{return/^\w+$/.test(e)?{ok:!0,data:n(2001)(e)}:{ok:!0,data:n(2001)(i.join(this.inout.paths.rootPath,e))}}catch(t){return{ok:!1,data:`cannot import js file '${e}'`}}})),t.jsSpecial.sleep=l.GenerateGuardedFunction("sleep",[o.PlStuffType.Num],(t=>(e((e=>{setTimeout((()=>{e()}),1e3*t)}))(),null)))}else{function e(t,n,s){let i=t;function u(e){return r.PlConverter.JsToPl(e,s)}let c=o.NewPlStuff(o.PlStuffType.Dict,{selector:n,new:l.GenerateGuardedFunction("new",[],(()=>(i=[document.createElement(n)],c))),attach:l.GenerateGuardedFunction("attach",[o.PlStuffType.Dict],(function(e){const t=e.value["#raw"];if(!t)throw new Error("cannot attach a none-node type");const n=t.value.get();return i[0].appendChild(n.result[0]),c})),detach:l.GenerateGuardedFunction("detach",[o.PlStuffType.Dict],(e=>{const t=e.value["#raw"];if(!t)throw new Error("cannot detach a none-node type");const n=t.value.get();return i[0].removeChild(n.result[0]),c})),clear:l.GenerateGuardedFunction("clear",[],(()=>{for(;i[0].firstChild;)i[0].firstChild.remove();return c})),setStyle:l.GenerateGuardedFunction("setStyle",[o.PlStuffType.Str,o.PlStuffType.Str],((e,t)=>(i[0].style[e.value]=t.value,c))),removeStyle:l.GenerateGuardedFunction("removeStyle",[o.PlStuffType.Str],(e=>(i[0].style[e.value]=null,c))),class:l.GenerateGuardedFunction("class",[],(()=>o.NewPlStuff(o.PlStuffType.Str,i[0].className))),setClass:l.GenerateGuardedFunction("setClass",[o.PlStuffType.Str],(e=>(i[0].className=e.value,c))),id:l.GenerateGuardedFunction("id",[],(()=>o.NewPlStuff(o.PlStuffType.Str,i[0].id))),setId:l.GenerateGuardedFunction("setId",[o.PlStuffType.Str],(e=>(i[0].id=e.value,c))),any:l.GenerateGuardedFunction("any",[],(()=>i.length>0?o.PlStuffTrue:o.PlStuffFalse)),size:l.GenerateGuardedFunction("size",[],(()=>o.NewPlStuff(o.PlStuffType.Num,i.length))),all:l.GenerateGuardedFunction("all",[],(function(){return o.NewPlStuff(o.PlStuffType.List,i.map((t=>e([t],n,s))))})),text:l.GenerateGuardedFunction("text",[],(function(){return u(i[0].innerText)})),setText:l.GenerateGuardedFunction("setText",[o.PlStuffType.Str],(function(e){return i[0].innerText=e.value,c})),html:l.GenerateGuardedFunction("text",[],(function(){return u(i[0].innerHTML)})),setHtml:l.GenerateGuardedFunction("setHTML",[o.PlStuffType.Str],(function(e){return i[0].innerHTML=e.value,c})),key:l.GenerateGuardedFunction("key",[o.PlStuffType.Str],(function(e){return u(i[0][e.value])})),setKey:l.GenerateGuardedFunction("setKey",[o.PlStuffType.Str,o.PlStuffTypeAny],(function(e,t){return i[0][e.value]=t.value,c})),attr:l.GenerateGuardedFunction("attr",[o.PlStuffType.Str],(function(e){return u(i[0].getAttribute(e.value))})),setAttr:l.GenerateGuardedFunction("setAttr",[o.PlStuffType.Str,o.PlStuffTypeAny],(function(e,t){return i[0].setAttribute(e.value,t.value),c})),listen:l.GenerateGuardedFunction("listen",[o.PlStuffType.Str,o.PlStuffType.Func],(function(e,t){let n;i[0].addEventListener(e.value,n=e=>{const n={preventDefault:()=>e.preventDefault(),"#raw":{_version:a,type:"Raw",value:e}};e.currentTarget&&(n.location={x:e.clientX-e.currentTarget.getBoundingClientRect().left,y:e.clientY-e.currentTarget.getBoundingClientRect().top}),e.key&&(n.key=e.key),r.PlConverter.PlToJs(t,s)(n)});const o=i[0];null==o.data&&(o.data={});const l=o.data[e.value];return null!=l&&i[0].removeEventListener(e.value,l),o.data[e.value]=n,c})),unlisten:l.GenerateGuardedFunction("unlisten",[o.PlStuffType.Str],(function(e){const t=i[0];null==t.data&&(t.data={});const n=t.data[e.value];return null!=n&&(i[0].removeEventListener(e.value,n),t.data[e.value]=void 0),c})),children:l.GenerateGuardedFunction("children",[],(()=>{const t=[];for(const n of i[0].children)t.push(e([n],"",s));return o.NewPlStuff(o.PlStuffType.List,t)})),remove:l.GenerateGuardedFunction("remove",[o.PlStuffType.Num],(e=>{const t=e.value-1;return i[0].removeChild(i[0].children[t]),c})),insert:l.GenerateGuardedFunction("insert",[o.PlStuffType.Num,o.PlStuffTypeAny],((e,t)=>{const n=t.value["#raw"];if(!n)throw new Error("cannot detach a none-node type");const r=e.value-1;if(r==i[0].children.length)return c.value.attach.value.native(t);const o=n.value.get();return i[0].insertBefore(o.result[0],i[0].children[r]),c})),$:l.GenerateGuardedFunction("$",[o.PlStuffType.Str],(t=>e(Array.from(i[0].querySelectorAll(t.value)),t.value,s))),parent:l.GenerateGuardedFunction("parent",[],(()=>e([i[0].parentElement],n+":parent",s)))});for(const e of Object.keys(c.value))c.value[e]=(f=c.value[e],o.NewPlStuff(o.PlStuffType.NFunc,f));var f;return c.value["#raw"]=o.NewPlStuff(o.PlStuffType.Raw,{get:()=>({result:i})}),c}t.jsSpecial.sleep=l.GenerateGuardedFunction("sleep",[o.PlStuffType.Num],(e=>{(e=>{const t=Date.now()+e;for(;Date.now()<t;)continue})(1e3*e)})),t.jsSpecial.fetch=l.GenerateGuardedFunction("fetch",[o.PlStuffType.Str,o.PlStuffTypeRest],(function(e,t){const n=c(t||{}),r=new XMLHttpRequest;r.open(n.method,e,!1);for(const[e,t]of Object.entries(n.headers))r.setRequestHeader(e,t);return r.send(n.body),{ok:2===Math.floor(r.status/100),status:r.status,text:r.responseText}})),t.special.$=l.GenerateGuardedFunction("$",[o.PlStuffType.Str],(function(t){return e(Array.from(document.querySelectorAll(t.value)),t.value,this)}))}},4214:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnscrambleFunction=t.ScrambleName=t.ScrambleImpl=t.ScrambleType=void 0;const r=n(1609),o=n(5473);t.ScrambleType=function(e,t){return`${null!=t?o.PlStuffTypeToString(t)+r.METHOD_SEP:""}${e}`},t.ScrambleImpl=function(e,t){return`${o.PlStuffGetType(t)}${r.METHOD_SEP}${e}`},t.ScrambleName=function(e,t){return`${t}${r.METHOD_SEP}${e}`},t.UnscrambleFunction=function(e){if(e.includes(r.METHOD_SEP)){const t=e.split("@");if(2!=t.length)throw new Error(`UnscrambleFunction unscrambled a name that contains more than two @, scrambled: '${e}'`);return[t[0],t[1]]}return["",e]}},5473:(e,t)=>{"use strict";var n;function r(e,t){return{type:e,value:t}}function o(e){switch(e){case n.Num:return"Num";case n.Type:return"Type";case n.Func:case n.NFunc:return"Func";case n.Bool:return"Bool";case n.Str:return"Str";case n.Null:return"Null";case n.List:return"List";case n.Inst:return"Inst";case n.Dict:return"Dict";case n.Raw:return"Raw"}throw new Error(`PlStuffTypeToString failed to match with value ${e}`)}Object.defineProperty(t,"__esModule",{value:!0}),t.PlStuffNull=t.PlStuffFalse=t.PlStuffTrue=t.PlStuffGetType=t.PlStuffTypeToString=t.PlStuffTypeToJsString=t.PlStuffTypeFromJsString=t.PlStuffTypeFromString=t.NewPlStuff=t.PlStuffTypes=t.PlStuffTypeRest=t.PlStuffTypeAny=t.PlStuffType=void 0,function(e){e[e.Num=0]="Num",e[e.Str=1]="Str",e[e.Bool=2]="Bool",e[e.Null=3]="Null",e[e.Type=4]="Type",e[e.Func=5]="Func",e[e.NFunc=6]="NFunc",e[e.List=7]="List",e[e.Dict=8]="Dict",e[e.Inst=9]="Inst",e[e.Raw=10]="Raw"}(n=t.PlStuffType||(t.PlStuffType={})),t.PlStuffTypeAny="*",t.PlStuffTypeRest="...",t.PlStuffTypes=["Num","Str","Bool","Null","Type","Func","List","Dict","Inst"],t.NewPlStuff=r,t.PlStuffTypeFromString=function(e){if(e in n)return n[e];throw new Error(`PlStuffTypeFromString failed to match with value ${e}`)},t.PlStuffTypeFromJsString=function(e){switch(e){case"boolean":return n.Bool;case"function":return n.Func;case"number":return n.Num;case"string":return n.Str;case"undefined":return n.Null;case"object":return n.Dict}throw new Error(`PlStuffTypeFromJsString failed to match with value ${e}`)},t.PlStuffTypeToJsString=function(e){switch(e){case n.Inst:return"object";case n.NFunc:case n.Func:return"function";case n.Str:return"string";case n.Num:return"number";case n.Bool:return"boolean";case n.Type:case n.Null:case n.List:return"object"}},t.PlStuffTypeToString=o,t.PlStuffGetType=function(e){switch(e.type){case n.Inst:return e.value.type}return o(e.type)},t.PlStuffTrue=Object.freeze(r(n.Bool,!0)),t.PlStuffFalse=Object.freeze(r(n.Bool,!1)),t.PlStuffNull=Object.freeze(r(n.Null,null))},2585:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OptimizeProgram=void 0;const r=n(4538),o=[function(e){let t=[],n=[];for(const o of e)o instanceof r.ASTFunction||o instanceof r.ASTType||o instanceof r.ASTImpl?t.push(o):n.push(o);return[...t,...n]}];t.OptimizeProgram=function(e){for(const t of o)e=t(e);return e}},4470:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=4470,e.exports=t},2001:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2001,e.exports=t},7245:e=>{"use strict";e.exports=require("blessed")},3129:e=>{"use strict";e.exports=require("child_process")},9907:e=>{"use strict";e.exports=require("deasync")},5747:e=>{"use strict";e.exports=require("fs")},6786:e=>{"use strict";e.exports=require("node-fetch")},2087:e=>{"use strict";e.exports=require("os")},5622:e=>{"use strict";e.exports=require("path")},2852:e=>{"use strict";e.exports=require("prompt-sync")},8887:e=>{"use strict";e.exports=require("prompt-sync-history")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var l=t[r]={exports:{}};return e[r].call(l.exports,l,l.exports,n),l.exports}n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.inout=e.linking=e.repl=e.browser=void 0,e.browser=n(1036),e.repl=n(8538),e.linking=n(181),e.inout=n(6962)})(),r})()}));